<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Hexacopter - 低空模拟器</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Hexacopter";
        var mkdocs_page_input_path = "wiki/hexacopter.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> 低空模拟器
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">主页</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../..">主页</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">构建 AirSim</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../use_precompiled/">下载二进制文件</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../build_windows/">在 Windows 上构建</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../build_linux/">在 Linux 上构建</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../build_macos/">在 macOS 上构建</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../docker_ubuntu/">Linux 上的 Docker</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../azure/">Azure 上的 ArSim</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../unreal_custenv/">定制虚幻引擎环境</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../build_faq/">场景问题和回答</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">使用 AirSim</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../apis/">核心 APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../image_apis/">图像 APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../apis_cpp/">C++ APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../api_docs/html/index.html">API 参考文档</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../">Wiki 文档</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../dev_workflow/">开发工作流</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../settings/">设置</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../map/">地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../camera_views/">相机视角</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../using_car/">汽车模式</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../remote_control/">远程控制</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../xbox_controller/">XBox 控制器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../steering_wheel_installation/">方向盘</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../multi_vehicle/">多车辆</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >传感器</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../sensors/">传感器</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../lidar/">激光雷达</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../distance_sensor/">距离传感器</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../InfraredCamera/">红外相机</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../airsim_ros_pkgs/">ROS: AirSim ROS 包装器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../airsim_tutorial_pkgs/">ROS: AirSim 教程包</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../gazebo_drone/">导入 Gazebo 模型</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../retexturing/">域随机化</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../meshes/">网格顶点缓冲区</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playback/">播放日志</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../voxel_grid/">体素网格生成器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../event_sim/">事件相机</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">设计</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../design/">架构</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../code_structure/">代码结构</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../adding_new_apis/">添加新的 APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../modify_recording_data/">修改记录数据</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../coding_guidelines/">编码指南</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../flight_controller/">飞行控制器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../simple_flight/">简单飞行</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../hello_drone/">Hello Drone</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">外部飞行控制器</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" >MavLink 和 PX4</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../px4_setup/">AirSim 的 PX4 设置</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../px4_sitl/">软件在环中的 PX4</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../px4_sitl_wsl2/">带有 WSL 2 的 PX4 SITL</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../px4_lockstep/">PX4 Lockstep</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../px4_multi_vehicle/">软件在环中的 PX4 多车辆</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://youtu.be/1oY8Qu5maQQ">AirSim 与 Pixhawk</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://youtu.be/HNWdYrtw3f0">使用 AirSim 设置 PX4</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://www.youtube.com/watch?v=d_FyjKDWQfc&feature=youtu.be">调试姿态估计</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://github.com/Microsoft/AirSim/wiki/Intercepting-MavLink-messages">拦截 MavLink 消息</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://github.com/Microsoft/AirSim/wiki/Rapid-Descent-on-PX4-drones">PX4 无人机快速下降</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../px4_build/">构建 PX4</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../px4_logging/">PX4/MavLink 日志记录</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../log_viewer/">MavLink 日志查看器</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../mavlinkcom/">MavLinkCom</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../mavlinkcom_mocap/">MavLink MoCap</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >ArduPilot</a>
    <ul>
                <li class="toctree-l2"><a class="" href="https://ardupilot.org/dev/docs/building-the-code.html">ArduPilot 软件在环设置</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://ardupilot.org/dev/docs/sitl-with-airsim.html">AirSim & ArduPilot</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">升级</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../unreal_upgrade/">升级虚幻引擎</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../upgrade_apis/">升级 APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../upgrade_settings/">升级设置</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">贡献教程</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../reinforcement_learning/">强化学习</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://www.youtube.com/watch?v=y09VbdQWvQY">使用 Marketplace 中的环境</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/simondlevy/AirSimTensorFlow">简单的防撞</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://aka.ms/AutonomousDrivingCookbook">Azure 上的自动驾驶</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/Microsoft/AirSim/wiki/hexacopter">构造六旋翼飞行器</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/Microsoft/AirSim/wiki/moveOnPath-demo">移动路径演示</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../point_clouds/">构建点云</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../drone_survey/">使用无人机进行测量</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../orbit/">轨道轨迹</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://youtu.be/Bp86WiLUC80">导入自定义多旋翼网格</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../object_detection/">Object Detection</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://youtu.be/ZonkdMcwXH4">带有 MAVROS 和 PX4 的 AirSim</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">杂项</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../custom_drone/">真实无人机上的 AirSim</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cmake_linux/">在 Linux 上安装 cmake</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../hard_drive/">硬盘繁忙时的提示</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../pfm/">pfm 格式</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../unreal_proj/">设置虚幻引擎环境</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../unreal_blocks/">Blocks 环境</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../who_is_using/">谁在使用 AirSim</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../working_with_plugin_contents/">使用 UE 插件内容</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../technion/technion/">大学生方程式赛车以色列理工学院自驾赛</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">支持</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../faq/">FAQ</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../SUPPORT/">支持</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../CHANGELOG/">修改记录</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../create_issue/">创建问题</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../CONTRIBUTING/">贡献</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">低空模拟器</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Hexacopter</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="_1">构造六旋翼飞行器<a class="headerlink" href="#_1" title="Permanent link">#</a></h2>
<p>那么 AirSim 能飞六旋翼飞行器吗？答案是可以，但设置起来需要一些工作。具体来说，需要更新三个组件：首先是 PX4 固件，然后是 AirSim 物理系统，最后是渲染模型。</p>
<h3 id="px4">PX4 修改<a class="headerlink" href="#px4" title="Permanent link">#</a></h3>
<p>PX4 需要处于<code>六轴飞行器模式(hexacopter mode)</code>，才能为所有 6 个电机提供输出。但是，如果您熟悉 QGroundControl 的“HIL 四轴飞行器”机身，您会注意到它没有 HIL 六轴飞行器。根据 PX4 团队的说法，我们不需要使用特殊的机身就能让 PX4 在 HIL 模式下正常工作，但很遗憾，今天我们不得不这么做。PX4 存在一些 bug，会导致 HIL 模式在任何机身上都无法正常工作。因此，除了修复这些 bug 之外，以下是获取 HIL 六轴飞行器机身选项的快速方法。首先，按照 <a href="https://github.com/Microsoft/AirSim/wiki/px4.md%5D">px4</a> 中的说明克隆 git 仓库，然后执行以下操作：</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>ROMFS/px4fmu_common/init.d
cp<span class="w"> </span>1001_rc_quad_x.hil<span class="w"> </span>1004_rc_hex_x.hil
gedit<span class="w"> </span>1004_rc_hex_x.hil
</code></pre></div>
<p>并使其包含以下内容：
<div class="highlight"><pre><span></span><code><span class="ch">#!nsh</span>
<span class="c1">#</span>
<span class="c1"># @name HIL Quadcopter +</span>
<span class="c1">#</span>
<span class="c1"># @type Simulation</span>
<span class="c1">#</span>
<span class="c1"># @maintainer Anton Babushkin &lt;anton@px4.io&gt;</span>
<span class="c1">#</span>

sh<span class="w"> </span>/etc/init.d/rc.mc_defaults

<span class="nb">set</span><span class="w"> </span>MIXER<span class="w"> </span>hexa_x

<span class="c1"># Need to set all 8 channels</span>
<span class="nb">set</span><span class="w"> </span>PWM_OUT<span class="w"> </span><span class="m">12345678</span>

<span class="nb">set</span><span class="w"> </span>HIL<span class="w"> </span>yes
</code></pre></div></p>
<p>保存此文件，然后使用 <code>make px4fmu-v2_default</code> 命令重新构建 px4。如果您已经构建过，请删除之前的构建输出 <code>build_px4fmu-v2_default</code>，以确保您的新构建选择这个新的ROMFS文件。</p>
<p>现在找到名为 <code>PX4AirframeFactMetaData.xml</code> 的 QGroundControl 配置文件，在 Windows 上，它位于 <code>%APPDATA%\QGroundControl.org\PX4AirframeFactMetaData.xml</code>。找到 airframe id="1001"，复制整个 airframe XML 元素并将其替换为：</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="nt">&lt;airframe</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;1004&quot;</span><span class="w"> </span><span class="na">maintainer=</span><span class="s">&quot;Anton Babushkin &amp;lt;anton@px4.io&amp;gt;&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;HIL Hexacopter X&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;maintainer&gt;</span>Anton<span class="w"> </span>Babushkin<span class="w"> </span><span class="ni">&amp;lt;</span>anton@px4.io<span class="ni">&amp;gt;</span><span class="nt">&lt;/maintainer&gt;</span>
<span class="w">      </span><span class="nt">&lt;type&gt;</span>Simulation<span class="nt">&lt;/type&gt;</span>
<span class="w">    </span><span class="nt">&lt;/airframe&gt;</span>
</code></pre></div>
<p>您可以将维护者设置为任意人。现在，当您的 Pixhawk 重启时，QGroundControl 应该会在“HIL”机身类型下显示一个 <code>HIL Hexacopter X</code> 选项，选择它并将其应用到 PX4 上，重启后，它就可以在 HIL 模式下作为六轴飞行器飞行了。</p>
<h3 id="airsim">AirSim 物理系统<a class="headerlink" href="#airsim" title="Permanent link">#</a></h3>
<p>物理很简单，您需要做的就是在 <a href="https://github.com/Microsoft/AirSim/wiki/settings.md">设置 json 文件</a> 中指定这个“模型”：
<div class="highlight"><pre><span></span><code><span class="s2">&quot;Model&quot;</span>:<span class="w"> </span><span class="s2">&quot;Hexacopter&quot;</span>,
</code></pre></div></p>
<p>但这有什么作用呢？在内部，这会导致 Px4MultiRotor.hpp 调用 setupFrameGenericHex()，后者调用 initializeRotorHexX，该方法根据 <a href="http://ardupilot.org/copter/docs/connect-escs-and-motors.html">推荐的电机布置</a> 执行以下操作。</p>
<div class="highlight"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initializeRotorHexX</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">RotorPose</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">rotor_poses</span><span class="w"> </span><span class="cm">/* the result we are building */</span><span class="p">,</span>
<span class="w">    </span><span class="n">uint</span><span class="w"> </span><span class="n">rotor_count</span><span class="w"> </span><span class="cm">/* must be 6 */</span><span class="p">,</span>
<span class="w">    </span><span class="n">real_T</span><span class="w"> </span><span class="n">arm_lengths</span><span class="p">[],</span>
<span class="w">    </span><span class="n">real_T</span><span class="w"> </span><span class="n">rotor_z</span><span class="w"> </span><span class="cm">/* z relative to center of gravity */</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Vector3r</span><span class="w"> </span><span class="n">unit_z</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span><span class="w">  </span><span class="c1">//NED frame</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rotor_count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">rotor_poses</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
<span class="w">        </span><span class="cm">/* Note: rotor_poses are built in this order: rotor 0 is CW</span>

<span class="cm">            x-axis</span>
<span class="cm">          (2)    (4)</span>
<span class="cm">            \  /</span>
<span class="cm">             \/</span>
<span class="cm">        (1)-------(0) y-axis</span>
<span class="cm">             /\</span>
<span class="cm">            /  \</span>
<span class="cm">          (5)  (3)</span>

<span class="cm">        */</span>

<span class="w">        </span><span class="c1">// vectors below are rotated according to NED left hand rule (so the vectors are rotated counter clockwise).</span>
<span class="w">        </span><span class="n">Quaternionr</span><span class="w"> </span><span class="n">quadx_rot</span><span class="p">(</span><span class="n">AngleAxisr</span><span class="p">(</span><span class="n">M_PIf</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="n">unit_z</span><span class="p">));</span>
<span class="w">        </span><span class="n">Quaternionr</span><span class="w"> </span><span class="n">no_rot</span><span class="p">(</span><span class="n">AngleAxisr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">unit_z</span><span class="p">));</span>
<span class="w">        </span><span class="n">rotor_poses</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">Vector3r</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">arm_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">rotor_z</span><span class="p">),</span>
<span class="w">            </span><span class="n">unit_z</span><span class="p">,</span><span class="w"> </span><span class="n">RotorTurningDirection</span><span class="o">::</span><span class="n">RotorTurningDirectionCW</span><span class="p">);</span>
<span class="w">        </span><span class="n">rotor_poses</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">Vector3r</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">arm_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">rotor_z</span><span class="p">),</span>
<span class="w">            </span><span class="n">unit_z</span><span class="p">,</span><span class="w"> </span><span class="n">RotorTurningDirection</span><span class="o">::</span><span class="n">RotorTurningDirectionCCW</span><span class="p">);</span>
<span class="w">        </span><span class="n">rotor_poses</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">VectorMath</span><span class="o">::</span><span class="n">rotateVector</span><span class="p">(</span><span class="n">Vector3r</span><span class="p">(</span><span class="n">arm_lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">rotor_z</span><span class="p">),</span><span class="w"> </span><span class="n">quadx_rot</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">),</span>
<span class="w">            </span><span class="n">unit_z</span><span class="p">,</span><span class="w"> </span><span class="n">RotorTurningDirection</span><span class="o">::</span><span class="n">RotorTurningDirectionCW</span><span class="p">);</span>
<span class="w">        </span><span class="n">rotor_poses</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">VectorMath</span><span class="o">::</span><span class="n">rotateVector</span><span class="p">(</span><span class="n">Vector3r</span><span class="p">(</span><span class="o">-</span><span class="n">arm_lengths</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">rotor_z</span><span class="p">),</span><span class="w"> </span><span class="n">quadx_rot</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">),</span>
<span class="w">            </span><span class="n">unit_z</span><span class="p">,</span><span class="w"> </span><span class="n">RotorTurningDirection</span><span class="o">::</span><span class="n">RotorTurningDirectionCCW</span><span class="p">);</span>
<span class="w">        </span><span class="n">rotor_poses</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">VectorMath</span><span class="o">::</span><span class="n">rotateVector</span><span class="p">(</span><span class="n">Vector3r</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">arm_lengths</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="n">rotor_z</span><span class="p">),</span><span class="w"> </span><span class="n">quadx_rot</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">),</span>
<span class="w">            </span><span class="n">unit_z</span><span class="p">,</span><span class="w"> </span><span class="n">RotorTurningDirection</span><span class="o">::</span><span class="n">RotorTurningDirectionCCW</span><span class="p">);</span>
<span class="w">        </span><span class="n">rotor_poses</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">VectorMath</span><span class="o">::</span><span class="n">rotateVector</span><span class="p">(</span><span class="n">Vector3r</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">arm_lengths</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="w"> </span><span class="n">rotor_z</span><span class="p">),</span><span class="w"> </span><span class="n">quadx_rot</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">),</span>
<span class="w">            </span><span class="n">unit_z</span><span class="p">,</span><span class="w"> </span><span class="n">RotorTurningDirection</span><span class="o">::</span><span class="n">RotorTurningDirectionCW</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">invalid_argument</span><span class="p">(</span><span class="s">&quot;Rotor count other than 6 is not supported by this method!&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>现在可能需要解释一下上面的 Vector3r 参数。上面标记为 (0) 的第一个电机位于 y 轴上，因此它的矢量很明显：<code>Vector3r(0, arm_lengths[0], rotate_z)</code>，x 轴为 0，y 轴为臂长。
标记为 (1) 的第二个电机也很明显。但是电机 (2) 呢？<code>VectorMath::rotateVector(Vector3r(arm_lengths[2], 0, rotate_z), quadx_rot, true)</code> 的 x 轴设置为臂长，y 轴设置为零，这意味着它在上图中一开始是垂直向上的。然后我们应用 pi/6 的旋转。但是旋转使用的是 NED 坐标系中的左手旋转规则，其中 z 轴向下，所以伸出左手，拇指向下，弯曲其他四指，这就是旋转的方向，即逆时针。因此，指向上方的臂会旋转到电机 (2) 所示的位置。其他机械臂也一样，现在我们的物理设置已经正确，可以用于六轴飞行器了。当然，你也可以根据需要增加质量，并调整电机推力参数。</p>
<h3 id="_2">渲染<a class="headerlink" href="#_2" title="Permanent link">#</a></h3>
<p>最后，为了进行渲染，我们需要一个漂亮的六旋翼飞行器三维模型。Udeshaya Wadhwa 制作了 <a href="https://grabcad.com/library/dji-s900-hex-rotor-drone-1">一个可爱的 DJI S900 模型</a> 。</p>
<p><img alt="" src="../images/Hexacopter.jpg" /></p>
<p>所以我拿了这个模型，把电机拆了下来（这样我们就可以旋转它们了），这些可以 <a href="https://github.com/Microsoft/AirSim/wiki/images/DJI%20S900.zip">在这里找到</a> 。你可以 <a href="https://docs.unrealengine.com/latest/INT/Engine/Content/Types/StaticMeshes/HowTo/Importing/index.html">把这些网格导入虚幻引擎</a> 。我发现，对于模块化社区世界，我必须将 x 轴旋转 90 度，并将模型缩小到原始尺寸的 20% 左右，将默认材质改为漂亮的金属灰色，并根据四轴飞行器蓝图添加单独的可旋转电机。</p>
<p>我所做的是复制并粘贴 BP_FlyingPawn，将其命名为 BP_FlyingHex，然后添加另外 2 个道具和另外 2 个旋转，如下所示：</p>
<p><img alt="" src="../images/BP_FlyingHex.png" /></p>
<p>然后我编辑了 SetupPropProtationMovement 图，以便它连接 2 个新的道具：</p>
<p><img alt="" src="../images/WireRotations.png" /></p>
<p>需要注意的是，您无法通过复制/粘贴来获取“Rotation 4”节点，您必须从“组件”列表中拖出“Rotation 4”，然后选择“获取”，然后将其连接到新的“设置更新组件”框，对于“Prop 4”和“Prop 5”也同样操作。</p>
<!--
mp4 转 gif: https://convertio.co/zh/mp4-gif/
-->
<p>现在您只需让它飞起来即可！是的，它成功了 :-) </p>
<p><img alt="" src="./images/Hex.gif" /></p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>OpenHUTB 版权所有 &copy; 2025</p>
  </div>

</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
