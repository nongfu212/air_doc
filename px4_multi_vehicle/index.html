<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>软件在环中的 PX4 多车辆 - 低空模拟器</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "\u8f6f\u4ef6\u5728\u73af\u4e2d\u7684 PX4 \u591a\u8f66\u8f86";
        var mkdocs_page_input_path = "px4_multi_vehicle.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> 低空模拟器
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">主页</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="..">主页</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">构建 AirSim</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../use_precompiled/">下载二进制文件</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_windows/">在 Windows 上构建</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_linux/">在 Linux 上构建</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_macos/">在 macOS 上构建</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../docker_ubuntu/">Linux 上的 Docker</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../azure/">Azure 上的 ArSim</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../unreal_custenv/">定制虚幻引擎环境</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_faq/">场景问题和回答</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">使用 AirSim</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../apis/">核心 APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../image_apis/">图像 APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../apis_cpp/">C++ APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../api_docs/html/index.html">API 参考文档</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../wiki/">Wiki 文档</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dev_workflow/">开发工作流</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../settings/">设置</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../map/">地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../camera_views/">相机视角</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../using_car/">汽车模式</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../remote_control/">远程控制</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../xbox_controller/">XBox 控制器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../steering_wheel_installation/">方向盘</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../multi_vehicle/">多车辆</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >传感器</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../sensors/">传感器</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../lidar/">激光雷达</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../distance_sensor/">距离传感器</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../InfraredCamera/">红外相机</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../airsim_ros_pkgs/">ROS: AirSim ROS 包装器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../airsim_tutorial_pkgs/">ROS: AirSim 教程包</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gazebo_drone/">导入 Gazebo 模型</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../retexturing/">域随机化</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../meshes/">网格顶点缓冲区</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../playback/">播放日志</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../voxel_grid/">体素网格生成器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../event_sim/">事件相机</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">设计</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../design/">架构</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../code_structure/">代码结构</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adding_new_apis/">添加新的 APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../modify_recording_data/">修改记录数据</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../coding_guidelines/">编码指南</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../flight_controller/">飞行控制器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../simple_flight/">简单飞行</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../hello_drone/">Hello Drone</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">外部飞行控制器</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" >MavLink 和 PX4</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../px4_setup/">AirSim 的 PX4 设置</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../px4_sitl/">软件在环中的 PX4</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../px4_sitl_wsl2/">带有 WSL 2 的 PX4 SITL</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../px4_lockstep/">PX4 Lockstep</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">软件在环中的 PX4 多车辆</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#setting-up-multiple-instances-of-px4-software-in-loop">Setting up multiple instances of PX4 Software-in-Loop</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#starting-sitl-instances-with-px4-console">Starting SITL instances with PX4 console</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="" href="https://youtu.be/1oY8Qu5maQQ">AirSim 与 Pixhawk</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://youtu.be/HNWdYrtw3f0">使用 AirSim 设置 PX4</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://www.youtube.com/watch?v=d_FyjKDWQfc&feature=youtu.be">调试姿态估计</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://github.com/Microsoft/AirSim/wiki/Intercepting-MavLink-messages">拦截 MavLink 消息</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://github.com/Microsoft/AirSim/wiki/Rapid-Descent-on-PX4-drones">PX4 无人机快速下降</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../px4_build/">构建 PX4</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../px4_logging/">PX4/MavLink 日志记录</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../log_viewer/">MavLink 日志查看器</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../mavlinkcom/">MavLinkCom</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../mavlinkcom_mocap/">MavLink MoCap</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >ArduPilot</a>
    <ul>
                <li class="toctree-l2"><a class="" href="https://ardupilot.org/dev/docs/building-the-code.html">ArduPilot 软件在环设置</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://ardupilot.org/dev/docs/sitl-with-airsim.html">AirSim & ArduPilot</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">升级</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../unreal_upgrade/">升级虚幻引擎</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../upgrade_apis/">升级 APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../upgrade_settings/">升级设置</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">贡献教程</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../reinforcement_learning/">强化学习</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://www.youtube.com/watch?v=y09VbdQWvQY">使用 Marketplace 中的环境</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/simondlevy/AirSimTensorFlow">简单的防撞</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://aka.ms/AutonomousDrivingCookbook">Azure 上的自动驾驶</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/Microsoft/AirSim/wiki/hexacopter">构造六旋翼飞行器</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/Microsoft/AirSim/wiki/moveOnPath-demo">移动路径演示</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../point_clouds/">构建点云</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../drone_survey/">使用无人机进行测量</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../orbit/">轨道轨迹</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://youtu.be/Bp86WiLUC80">导入自定义多旋翼网格</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../object_detection/">Object Detection</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://youtu.be/ZonkdMcwXH4">带有 MAVROS 和 PX4 的 AirSim</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">杂项</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../custom_drone/">真实无人机上的 AirSim</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cmake_linux/">在 Linux 上安装 cmake</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../hard_drive/">硬盘繁忙时的提示</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../pfm/">pfm 格式</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../unreal_proj/">设置虚幻引擎环境</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../unreal_blocks/">Blocks 环境</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../who_is_using/">谁在使用 AirSim</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../working_with_plugin_contents/">使用 UE 插件内容</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../wiki/technion/technion/">大学生方程式赛车以色列理工学院自驾赛</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">支持</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../faq/">FAQ</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../SUPPORT/">支持</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CHANGELOG/">修改记录</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../create_issue/">创建问题</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING/">贡献</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">低空模拟器</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">外部飞行控制器</li>
          <li class="breadcrumb-item">MavLink 和 PX4</li>
      <li class="breadcrumb-item active">软件在环中的 PX4 多车辆</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="setting-up-multi-vehicle-px4-simulation">Setting up multi-vehicle PX4 simulation<a class="headerlink" href="#setting-up-multi-vehicle-px4-simulation" title="Permanent link">#</a></h1>
<p>The <a href="../px4_sitl/">PX4 SITL stack</a> comes with a <code>sitl_multiple_run.sh</code> shell script that runs multiple instances of the PX4 binary. This would allow the SITL stack to listen to connections from multiple AirSim vehicles on multiple TCP ports starting from 4560.
However, the provided script does not let us view the PX4 console. If you want to run the instances manually while being able to view each instance's console (<strong>Recommended</strong>) see <a href="./#starting-sitl-instances-with-px4-console">this section</a> </p>
<h2 id="setting-up-multiple-instances-of-px4-software-in-loop">Setting up multiple instances of PX4 Software-in-Loop<a class="headerlink" href="#setting-up-multiple-instances-of-px4-software-in-loop" title="Permanent link">#</a></h2>
<p><strong>Note</strong> you have to build PX4 with <code>make px4_sitl_default none_iris</code> as shown <a href="../px4_sitl/#setting-up-px4-software-in-loop">here</a> before trying to run multiple PX4 instances.</p>
<ol>
<li>
<p>From your bash (or Cygwin) terminal go to the PX4 Firmware directory and run the <code>sitl_multiple_run.sh</code> script while specifying the number of vehicles you need
    <div class="highlight"><pre><span></span><code>cd PX4-Autopilot
./Tools/sitl_multiple_run.sh 2    # 2 here is the number of vehicles/instances 
</code></pre></div>
    This starts multiple instances that listen to TCP ports 4560 to 4560+i where 'i' is the number of vehicles/instances specified</p>
</li>
<li>
<p>You should get a confirmation message that says that old instances have been stopped and new instances have been started
    <div class="highlight"><pre><span></span><code>killing running instances
starting instance 0 in /cygdrive/c/PX4/home/PX4/Firmware/build/px4_sitl_default/instance_0
starting instance 1 in /cygdrive/c/PX4/home/PX4/Firmware/build/px4_sitl_default/instance_1
</code></pre></div></p>
</li>
<li>
<p>Now edit <a href="../settings/">AirSim settings</a> file to make sure you have matching TCP port settings for the set number of vehicles and to make sure that both vehicles do not spawn on the same point. </p>
<p>For example, these settings would spawn two PX4Multirotors where one of them would try to connect to PX4 SITL at port <code>4560</code> and the other at port <code>4561</code>. It also makes sure the vehicles spawn at <code>0,1,0</code> and <code>0,-1,0</code> to avoid collision:
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;SettingsVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.2</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;SimMode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Multirotor&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Vehicles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;Drone1&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;VehicleType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PX4Multirotor&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;UseSerial&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;UseTcp&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;TcpPort&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4560</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;ControlPortLocal&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">14540</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;ControlPortRemote&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">14580</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;X&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;Y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;Z&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;Drone2&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;VehicleType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PX4Multirotor&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;UseSerial&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;UseTcp&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;TcpPort&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4561</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;ControlPortLocal&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">14541</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;ControlPortRemote&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">14581</span><span class="p">,</span><span class="w">       </span>
<span class="w">            </span><span class="nt">&quot;X&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;Y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;Z&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
</code></pre></div>
You can add more than two vehicles but you will need to make sure you adjust the TCP port for each (ie: vehicle 3's port would be <code>4562</code> and so on..) and adjust the spawn point.</p>
</li>
<li>
<p>Now run your Unreal AirSim environment and it should connect to SITL PX4 via TCP.
If you are running the instances with the <a href="./#Starting-sitl-instances-with-px4-console">PX4 console visible</a>, you should see a bunch of messages from each SITL PX4 window.
Specifically, the following messages tell you that AirSim is connected properly and GPS fusion is stable:
    <div class="highlight"><pre><span></span><code>INFO  [simulator] Simulator connected on UDP port 14560
INFO  [mavlink] partner IP: 127.0.0.1
INFO  [ecl/EKF] EKF GPS checks passed (WGS-84 origin set)
INFO  [ecl/EKF] EKF commencing GPS fusion
</code></pre></div></p>
<p>If you do not see these messages then check your port settings.</p>
</li>
<li>
<p>You should also be able to use QGroundControl with SITL mode.  Make sure
there is no Pixhawk hardware plugged in, otherwise QGroundControl will choose
to use that instead.  Note that as we don't have a physical board, an RC cannot be connected directly to it. So the alternatives are either use XBox 360 Controller or connect your RC using USB (for example, in case of FrSky Taranis X9D Plus) or using trainer USB cable to your PC. This makes your RC look like a joystick. You will need to do extra set up in QGroundControl to use virtual joystick for RC control.  You do not need to do this unless you plan to fly a drone manually in AirSim.  Autonomous flight using the Python
API does not require RC, see <a href="../px4_sitl/#No-Remote-Control"><code>No Remote Control</code></a>.</p>
</li>
</ol>
<h2 id="starting-sitl-instances-with-px4-console">Starting SITL instances with PX4 console<a class="headerlink" href="#starting-sitl-instances-with-px4-console" title="Permanent link">#</a></h2>
<p>If you want to start your SITL instances while being able to view the PX4 console, you will need to run the shell scripts found <a href="https://github.com/microsoft/AirSim/tree/main/PX4Scripts">here</a> rather than <code>sitl_multiple_run.sh</code>.
Here is how you would do so:</p>
<p><strong>Note</strong> This script also assumes PX4 is built with <code>make px4_sitl_default none_iris</code> as shown <a href="../px4_sitl/#setting-up-px4-software-in-loop">here</a> before trying to run multiple PX4 instances.</p>
<ol>
<li>From your bash (or Cygwin) terminal go to the PX4 directory and get the scripts (place them in a subdirectory called Scripts win the PX4 directory as shown)
    <div class="highlight"><pre><span></span><code>cd PX4
mkdir -p Scripts
cd Scripts
wget https://github.com/microsoft/AirSim/raw/main/PX4Scripts/sitl_kill.sh
wget https://github.com/microsoft/AirSim/raw/main/PX4Scripts/run_airsim_sitl.sh
</code></pre></div>
    <strong>Note</strong> the shell scripts expect the <code>Scripts</code> and <code>Firmware</code> directories to be within the same parent directory. Also, you may need to make the scripts executable by running <code>chmod +x sitl_kill.sh</code> and <code>chmod +x run_airsim_sitl.sh</code>.</li>
<li>
<p>Run the <code>sitl_kill.sh</code> script to kill all active PX4 SITL instances 
    <div class="highlight"><pre><span></span><code>./sitl_kill.sh
</code></pre></div></p>
</li>
<li>
<p>Run the <code>run_airsim_sitl.sh</code> script while specifying which instance you would like to run in the current terminal window (the first instance would be numbered 0)
    <div class="highlight"><pre><span></span><code>./run_airsim_sitl.sh 0 # first instance = 0
</code></pre></div></p>
<p>You should see the PX4 instance starting and waiting for AirSim's connection as it would with a single instance.
<div class="highlight"><pre><span></span><code>______  __   __    ___
| ___ \ \ \ / /   /   |
| |_/ /  \ V /   / /| |
|  __/   /   \  / /_| |
| |     / /^\ \ \___  |
\_|     \/   \/     |_/

px4 starting.
INFO  [px4] Calling startup script: /bin/sh /cygdrive/c/PX4/home/PX4/Firmware/etc/init.d-posix/rcS 0
INFO  [dataman] Unknown restart, data manager file &#39;./dataman&#39; size is 11798680 bytes
INFO  [simulator] Waiting for simulator to connect on TCP port 4560
</code></pre></div>
4. Open a new terminal and go to the Scripts directory and start the next instance
<div class="highlight"><pre><span></span><code>cd PX4
cd Scripts
./run_airsim_sitl.sh 1  # ,2,3,4,..,etc
</code></pre></div></p>
</li>
<li>
<p>Repeat step 4 for as many instances as you would like to start</p>
</li>
<li>
<p>Run your Unreal AirSim environment and it should connect to SITL PX4 via TCP (assuming your settings.json file has the right ports).</p>
</li>
</ol>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../px4_lockstep/" class="btn btn-neutral float-left" title="PX4 Lockstep"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../px4_build/" class="btn btn-neutral float-right" title="构建 PX4">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>OpenHUTB 版权所有 &copy; 2025</p>
  </div>

</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../px4_lockstep/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../px4_build/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
