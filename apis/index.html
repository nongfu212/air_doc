<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>核心 APIs - 低空模拟器</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "\u6838\u5fc3 APIs";
        var mkdocs_page_input_path = "apis.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> 低空模拟器
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">主页</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="..">主页</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">构建 AirSim</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../use_precompiled/">下载二进制文件</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_windows/">在 Windows 上构建</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_linux/">在 Linux 上构建</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_macos/">在 macOS 上构建</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../docker_ubuntu/">Linux 上的 Docker</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../azure/">Azure 上的 ArSim</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../unreal_custenv/">定制虚幻引擎环境</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_faq/">场景问题和回答</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">使用 AirSim</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">核心 APIs</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#_1">介绍</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#python">Python 快速入门</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#airsim">安装 AirSim 包</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#c">C++ 用户</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#hello-car">Hello Car</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#hello-drone">Hello Drone</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#api">常用 API</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#image-computer-vision-apis">Image / Computer Vision APIs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#pause-and-continue-apis">Pause and Continue APIs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#collision-api">Collision API</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#time-of-day-api">Time of Day API</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#line-of-sight-and-world-extent-apis">Line-of-sight and world extent APIs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#weather-apis">Weather APIs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#recording-apis">Recording APIs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#wind-api">Wind API</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#lidar-apis">Lidar APIs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#light-control-apis">Light Control APIs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#texture-apis">Texture APIs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#multiple-vehicles">Multiple Vehicles</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#coordinate-system">Coordinate System</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vehicle-specific-apis">Vehicle Specific APIs</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#apis-for-car">APIs for Car</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#apis-for-multirotor">APIs for Multirotor</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#getmultirotorstate">getMultirotorState</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#async-methods-duration-and-max_wait_seconds">Async methods, duration and max_wait_seconds</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#drivetrain">drivetrain</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#yaw_mode">yaw_mode</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#lookahead-and-adaptive_lookahead">lookahead and adaptive_lookahead</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using-apis-on-real-vehicles">Using APIs on Real Vehicles</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#airsim-api">向 AirSim 添加新的 API</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#references-and-examples">References and Examples</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#faq">FAQ</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#unreal-is-slowed-down-dramatically-when-i-run-api">Unreal is slowed down dramatically when I run API</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#do-i-need-anything-else-on-windows">Do I need anything else on Windows?</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#which-version-of-python-should-i-use">Which version of Python should I use?</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#i-get-error-on-import-cv2">I get error on import cv2</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#typeerror-unsupported-operand-types-for-asyncioloop-and-float">TypeError: unsupported operand type(s) for *: 'AsyncIOLoop' and 'float'</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../image_apis/">图像 APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../apis_cpp/">C++ APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../api_docs/html/index.html">API 参考文档</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../wiki/">Wiki 文档</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dev_workflow/">开发工作流</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../settings/">设置</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../map/">地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../camera_views/">相机视角</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../using_car/">汽车模式</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../remote_control/">远程控制</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../xbox_controller/">XBox 控制器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../steering_wheel_installation/">方向盘</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../multi_vehicle/">多车辆</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">传感器</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../sensors/">传感器</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../lidar/">激光雷达</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../distance_sensor/">距离传感器</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../InfraredCamera/">红外相机</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../airsim_ros_pkgs/">ROS: AirSim ROS 包装器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../airsim_tutorial_pkgs/">ROS: AirSim 教程包</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gazebo_drone/">导入 Gazebo 模型</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../retexturing/">域随机化</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../meshes/">网格顶点缓冲区</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../playback/">播放日志</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../voxel_grid/">体素网格生成器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../event_sim/">事件相机</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">设计</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../design/">架构</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../code_structure/">代码结构</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adding_new_apis/">添加新的 APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../modify_recording_data/">修改记录数据</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../coding_guidelines/">编码指南</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../flight_controller/">飞行控制器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../simple_flight/">简单飞行</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../hello_drone/">Hello Drone</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">外部飞行控制器</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">MavLink 和 PX4</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../px4_setup/">AirSim 的 PX4 设置</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../px4_sitl/">软件在环中的 PX4</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../px4_sitl_wsl2/">带有 WSL 2 的 PX4 SITL</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../px4_lockstep/">PX4 Lockstep</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../px4_multi_vehicle/">软件在环中的 PX4 多车辆</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://youtu.be/1oY8Qu5maQQ">AirSim 与 Pixhawk</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://youtu.be/HNWdYrtw3f0">使用 AirSim 设置 PX4</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://www.youtube.com/watch?v=d_FyjKDWQfc&feature=youtu.be">调试姿态估计</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://github.com/Microsoft/AirSim/wiki/Intercepting-MavLink-messages">拦截 MavLink 消息</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://github.com/Microsoft/AirSim/wiki/Rapid-Descent-on-PX4-drones">PX4 无人机快速下降</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../px4_build/">构建 PX4</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../px4_logging/">PX4/MavLink 日志记录</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../log_viewer/">MavLink 日志查看器</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../mavlinkcom/">MavLinkCom</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../mavlinkcom_mocap/">MavLink MoCap</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">ArduPilot</a>
    <ul>
                <li class="toctree-l2"><a class="" href="https://ardupilot.org/dev/docs/building-the-code.html">ArduPilot 软件在环设置</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://ardupilot.org/dev/docs/sitl-with-airsim.html">AirSim & ArduPilot</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">升级</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../unreal_upgrade/">升级虚幻引擎</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../upgrade_apis/">升级 APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../upgrade_settings/">升级设置</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">贡献教程</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../reinforcement_learning/">强化学习</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://www.youtube.com/watch?v=y09VbdQWvQY">使用 Marketplace 中的环境</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/simondlevy/AirSimTensorFlow">简单的防撞</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://aka.ms/AutonomousDrivingCookbook">Azure 上的自动驾驶</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/Microsoft/AirSim/wiki/hexacopter">构造六旋翼飞行器</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/Microsoft/AirSim/wiki/moveOnPath-demo">移动路径演示</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../point_clouds/">构建点云</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../drone_survey/">使用无人机进行测量</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../orbit/">轨道轨迹</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://youtu.be/Bp86WiLUC80">导入自定义多旋翼网格</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../object_detection/">Object Detection</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://youtu.be/ZonkdMcwXH4">带有 MAVROS 和 PX4 的 AirSim</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">杂项</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../custom_drone/">真实无人机上的 AirSim</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cmake_linux/">在 Linux 上安装 cmake</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../hard_drive/">硬盘繁忙时的提示</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../pfm/">pfm 格式</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../unreal_proj/">设置虚幻引擎环境</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../unreal_blocks/">Blocks 环境</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../who_is_using/">谁在使用 AirSim</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../working_with_plugin_contents/">使用 UE 插件内容</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../wiki/technion/technion/">大学生方程式赛车以色列理工学院自驾赛</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">支持</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../faq/">FAQ</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../SUPPORT/">支持</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CHANGELOG/">修改记录</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../create_issue/">创建问题</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING/">贡献</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">低空模拟器</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">使用 AirSim</li>
      <li class="breadcrumb-item active">核心 APIs</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="airsim-apis">AirSim APIs<a class="headerlink" href="#airsim-apis" title="Permanent link">#</a></h1>
<h2 id="_1">介绍<a class="headerlink" href="#_1" title="Permanent link">#</a></h2>
<p>AirSim 提供 API，方便您以编程方式与模拟中的车辆进行交互。您可以使用这些 API 来检索图像、获取状态、控制车辆等等。</p>
<h2 id="python">Python 快速入门<a class="headerlink" href="#python" title="Permanent link">#</a></h2>
<p>如果您想使用 Python 调用 AirSim API，我们建议使用带有 Python 3.5 或更高版本的 Anaconda，但某些代码也可能适用于 Python 2.7（ <a href="../CONTRIBUTING/">帮助我们</a> 提高兼容性！）。</p>
<p>首先安装 Python 虚拟环境：
<div class="highlight"><pre><span></span><code>conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>air<span class="w"> </span><span class="nv">python</span><span class="o">=</span><span class="m">3</span>.8
conda<span class="w"> </span>activate<span class="w"> </span>air
</code></pre></div></p>
<p>首先安装这个包：</p>
<div class="highlight"><pre><span></span><code>pip install msgpack-rpc-python
</code></pre></div>
<p>您可以从 <a href="https://github.com/Microsoft/AirSim/releases">releases</a> 获取 AirSim 二进制文件，也可以从源代码编译（<a href="../build_windows/">Windows</a>、<a href="../build_linux/">Linux</a>）。一旦您可以运行 AirSim，请选择 Car 作为载具，然后导航到 <code>PythonClient\car\</code> 文件夹并运行：</p>
<div class="highlight"><pre><span></span><code>python hello_car.py
</code></pre></div>
<p>如果您正在使用 Visual Studio 2019，则只需打开 AirSim.sln ，将 PythonClient 设置为启动项目，并选择 <code>car\hello_car.py</code> 作为启动脚本。</p>
<h3 id="airsim">安装 AirSim 包<a class="headerlink" href="#airsim" title="Permanent link">#</a></h3>
<p>您也可以简单地通过以下方式安装 <code>airsim</code> 包：，</p>
<div class="highlight"><pre><span></span><code>pip install airsim
</code></pre></div>
<p>您可以在代码仓库的 <code>PythonClient</code> 文件夹中找到该包的源代码和示例。</p>
<p><strong>笔记</strong>
1. 您可能会注意到在我们的示例文件夹中有一个 <code>setup_path.py</code> 文件。这个文件有一个简单的代码来检测 <code>airsim</code> 包是否在父文件夹中可用，在这种情况下，我们使用它而不是 pip 安装的包，所以您总是使用最新的代码。
2. AirSim 仍在大量开发中，这意味着您可能需要经常更新软件包以使用新的 API。</p>
<h2 id="c">C++ 用户<a class="headerlink" href="#c" title="Permanent link">#</a></h2>
<p>如果要使用 C++ 的 API 和示例，请参阅 <a href="../apis_cpp/">C++ APIs 指南</a> 。</p>
<h2 id="hello-car">Hello Car<a class="headerlink" href="#hello-car" title="Permanent link">#</a></h2>
<p>下面是如何使用 Python 的 AirSim API 控制模拟汽车（另请参见 <a href="../apis_cpp/#hello_car">C++ 示例</a> ）：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 准备运行示例：PythonClient/car/hello_car.py</span>
<span class="kn">import</span> <span class="nn">airsim</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># 连接到 AirSim 模拟器</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">airsim</span><span class="o">.</span><span class="n">CarClient</span><span class="p">()</span>
<span class="n">client</span><span class="o">.</span><span class="n">confirmConnection</span><span class="p">()</span>
<span class="n">client</span><span class="o">.</span><span class="n">enableApiControl</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">car_controls</span> <span class="o">=</span> <span class="n">airsim</span><span class="o">.</span><span class="n">CarControls</span><span class="p">()</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="c1"># 获取车辆状态</span>
    <span class="n">car_state</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">getCarState</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Speed </span><span class="si">%d</span><span class="s2">, Gear </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">car_state</span><span class="o">.</span><span class="n">speed</span><span class="p">,</span> <span class="n">car_state</span><span class="o">.</span><span class="n">gear</span><span class="p">))</span>

    <span class="c1"># 控制车辆</span>
    <span class="n">car_controls</span><span class="o">.</span><span class="n">throttle</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">car_controls</span><span class="o">.</span><span class="n">steering</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">client</span><span class="o">.</span><span class="n">setCarControls</span><span class="p">(</span><span class="n">car_controls</span><span class="p">)</span>

    <span class="c1"># 让汽车开一会儿</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># 从汽车中获取相机图像</span>
    <span class="n">responses</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">simGetImages</span><span class="p">([</span>
        <span class="n">airsim</span><span class="o">.</span><span class="n">ImageRequest</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">airsim</span><span class="o">.</span><span class="n">ImageType</span><span class="o">.</span><span class="n">DepthVis</span><span class="p">),</span>
        <span class="n">airsim</span><span class="o">.</span><span class="n">ImageRequest</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">airsim</span><span class="o">.</span><span class="n">ImageType</span><span class="o">.</span><span class="n">DepthPlanar</span><span class="p">,</span> <span class="kc">True</span><span class="p">)])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Retrieved images: </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">responses</span><span class="p">))</span>

    <span class="c1"># 对图像执行一些操作</span>
    <span class="k">for</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">responses</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">pixels_as_float</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Type </span><span class="si">%d</span><span class="s2">, size </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">image_type</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">image_data_float</span><span class="p">)))</span>
            <span class="n">airsim</span><span class="o">.</span><span class="n">write_pfm</span><span class="p">(</span><span class="s1">&#39;py1.pfm&#39;</span><span class="p">,</span> <span class="n">airsim</span><span class="o">.</span><span class="n">get_pfm_array</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Type </span><span class="si">%d</span><span class="s2">, size </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">image_type</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">image_data_uint8</span><span class="p">)))</span>
            <span class="n">airsim</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="s1">&#39;py1.png&#39;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">image_data_uint8</span><span class="p">)</span>
</code></pre></div>
<h2 id="hello-drone">Hello Drone<a class="headerlink" href="#hello-drone" title="Permanent link">#</a></h2>
<p>下面介绍了如何使用 Python 的 AirSim API 来控制模拟四旋翼飞行器（另请参阅 <a href="../apis_cpp/#hello_drone"> C++ 示例</a>）：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 准备运行示例：PythonClient/multirotor/hello_drone.py</span>
<span class="kn">import</span> <span class="nn">airsim</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># 连接到 AirSim 模拟器</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">airsim</span><span class="o">.</span><span class="n">MultirotorClient</span><span class="p">()</span>
<span class="n">client</span><span class="o">.</span><span class="n">confirmConnection</span><span class="p">()</span>
<span class="n">client</span><span class="o">.</span><span class="n">enableApiControl</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">armDisarm</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Async 方法返回 Future。调用 join() 等待任务完成。</span>
<span class="n">client</span><span class="o">.</span><span class="n">takeoffAsync</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<span class="n">client</span><span class="o">.</span><span class="n">moveToPositionAsync</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

<span class="c1"># 获取图像</span>
<span class="n">responses</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">simGetImages</span><span class="p">([</span>
    <span class="n">airsim</span><span class="o">.</span><span class="n">ImageRequest</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="n">airsim</span><span class="o">.</span><span class="n">ImageType</span><span class="o">.</span><span class="n">DepthVis</span><span class="p">),</span>
    <span class="n">airsim</span><span class="o">.</span><span class="n">ImageRequest</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">airsim</span><span class="o">.</span><span class="n">ImageType</span><span class="o">.</span><span class="n">DepthPlanar</span><span class="p">,</span> <span class="kc">True</span><span class="p">)])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Retrieved images: </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">responses</span><span class="p">))</span>

<span class="c1"># 对图像执行一些操作</span>
<span class="k">for</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">responses</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">pixels_as_float</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Type </span><span class="si">%d</span><span class="s2">, size </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">image_type</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">image_data_float</span><span class="p">)))</span>
        <span class="n">airsim</span><span class="o">.</span><span class="n">write_pfm</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="s1">&#39;/temp/py1.pfm&#39;</span><span class="p">),</span> <span class="n">airsim</span><span class="o">.</span><span class="n">get_pfm_array</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Type </span><span class="si">%d</span><span class="s2">, size </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">image_type</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">image_data_uint8</span><span class="p">)))</span>
        <span class="n">airsim</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="s1">&#39;/temp/py1.png&#39;</span><span class="p">),</span> <span class="n">response</span><span class="o">.</span><span class="n">image_data_uint8</span><span class="p">)</span>
</code></pre></div>
<h2 id="api">常用 API<a class="headerlink" href="#api" title="Permanent link">#</a></h2>
<ul>
<li><code>reset</code>: This resets the vehicle to its original starting state. Note that you must call <code>enableApiControl</code> and <code>armDisarm</code> again after the call to <code>reset</code>.</li>
<li><code>confirmConnection</code>: Checks state of connection every 1 sec and reports it in Console so user can see the progress for connection.</li>
<li><code>enableApiControl</code>: For safety reasons, by default API control for autonomous vehicle is not enabled and human operator has full control (usually via RC or joystick in simulator). The client must make this call to request control via API. It is likely that human operator of vehicle might have disallowed API control which would mean that enableApiControl has no effect. This can be checked by <code>isApiControlEnabled</code>.</li>
<li><code>isApiControlEnabled</code>: Returns true if API control is established. If false (which is default) then API calls would be ignored. After a successful call to <code>enableApiControl</code>, the <code>isApiControlEnabled</code> should return true.</li>
<li><code>ping</code>: If connection is established then this call will return true otherwise it will be blocked until timeout.</li>
<li><code>simPrintLogMessage</code>: Prints the specified message in the simulator's window. If message_param is also supplied then its printed next to the message and in that case if this API is called with same message value but different message_param again then previous line is overwritten with new line (instead of API creating new line on display). For example, <code>simPrintLogMessage("Iteration: ", to_string(i))</code> keeps updating same line on display when API is called with different values of i. The valid values of severity parameter is 0 to 3 inclusive that corresponds to different colors.</li>
<li><code>simGetObjectPose</code>, <code>simSetObjectPose</code>: Gets and sets the pose of specified object in Unreal environment. Here the object means "actor" in Unreal terminology. They are searched by tag as well as name. Please note that the names shown in UE Editor are <em>auto-generated</em> in each run and are not permanent. So if you want to refer to actor by name, you must change its auto-generated name in UE Editor. Alternatively you can add a tag to actor which can be done by clicking on that actor in Unreal Editor and then going to <a href="https://answers.unrealengine.com/questions/543807/whats-the-difference-between-tag-and-tag.html">Tags property</a>, click "+" sign and add some string value. If multiple actors have same tag then the first match is returned. If no matches are found then NaN pose is returned. The returned pose is in NED coordinates in SI units in the world frame. For <code>simSetObjectPose</code>, the specified actor must have <a href="https://docs.unrealengine.com/en-us/Engine/Actors/Mobility">Mobility</a> set to Movable or otherwise you will get undefined behavior. The <code>simSetObjectPose</code> has parameter <code>teleport</code> which means object is <a href="https://www.unrealengine.com/en-US/blog/moving-physical-objects">moved through other objects</a> in its way and it returns true if move was successful</li>
</ul>
<h3 id="image-computer-vision-apis">Image / Computer Vision APIs<a class="headerlink" href="#image-computer-vision-apis" title="Permanent link">#</a></h3>
<p>AirSim offers comprehensive images APIs to retrieve synchronized images from multiple cameras along with ground truth including depth, disparity, surface normals and vision. You can set the resolution, FOV, motion blur etc parameters in <a href="../settings/">settings.json</a>. There is also API for detecting collision state. See also <a href="https://github.com/Microsoft/AirSim/tree/main/Examples/DataCollection/StereoImageGenerator.hpp">complete code</a> that generates specified number of stereo images and ground truth depth with normalization to camera plane, computation of disparity image and saving it to <a href="../pfm/">pfm format</a>.</p>
<p>More on <a href="../image_apis/">image APIs and Computer Vision mode</a>.
For vision problems that can benefit from domain randomization, there is also an <a href="../retexturing/">object retexturing API</a>, which can be used in supported scenes.</p>
<h3 id="pause-and-continue-apis">Pause and Continue APIs<a class="headerlink" href="#pause-and-continue-apis" title="Permanent link">#</a></h3>
<p>AirSim allows to pause and continue the simulation through <code>pause(is_paused)</code> API. To pause the simulation call <code>pause(True)</code> and to continue the simulation call <code>pause(False)</code>. You may have scenario, especially while using reinforcement learning, to run the simulation for specified amount of time and then automatically pause. While simulation is paused, you may then do some expensive computation, send a new command and then again run the simulation for specified amount of time. This can be achieved by API <code>continueForTime(seconds)</code>. This API runs the simulation for the specified number of seconds and then pauses the simulation. For example usage, please see <a href="https://github.com/Microsoft/AirSim/tree/main/PythonClient//car/pause_continue_car.py">pause_continue_car.py</a> and <a href="https://github.com/Microsoft/AirSim/tree/main/PythonClient//multirotor/pause_continue_drone.py">pause_continue_drone.py</a>.</p>
<h3 id="collision-api">Collision API<a class="headerlink" href="#collision-api" title="Permanent link">#</a></h3>
<p>The collision information can be obtained using <code>simGetCollisionInfo</code> API. This call returns a struct that has information not only whether collision occurred but also collision position, surface normal, penetration depth and so on.</p>
<h3 id="time-of-day-api">Time of Day API<a class="headerlink" href="#time-of-day-api" title="Permanent link">#</a></h3>
<p>AirSim assumes there exist sky sphere of class <code>EngineSky/BP_Sky_Sphere</code> in your environment with <a href="https://github.com/microsoft/AirSim/blob/v1.4.0-linux/Unreal/Plugins/AirSim/Source/SimMode/SimModeBase.cpp#L224">ADirectionalLight actor</a>. By default, the position of the sun in the scene doesn't move with time. You can use <a href="../settings/#timeofday">settings</a> to set up latitude, longitude, date and time which AirSim uses to compute the position of sun in the scene.</p>
<p>You can also use following API call to set the sun position according to given date time:</p>
<div class="highlight"><pre><span></span><code>simSetTimeOfDay(self, is_enabled, start_datetime = &quot;&quot;, is_start_datetime_dst = False, celestial_clock_speed = 1, update_interval_secs = 60, move_sun = True)
</code></pre></div>
<p>The <code>is_enabled</code> parameter must be <code>True</code> to enable time of day effect. If it is <code>False</code> then sun position is reset to its original in the environment.</p>
<p>Other parameters are same as in <a href="../settings/#timeofday">settings</a>.</p>
<h3 id="line-of-sight-and-world-extent-apis">Line-of-sight and world extent APIs<a class="headerlink" href="#line-of-sight-and-world-extent-apis" title="Permanent link">#</a></h3>
<p>To test line-of-sight in the sim from a vehicle to a point or between two points, see simTestLineOfSightToPoint(point, vehicle_name) and simTestLineOfSightBetweenPoints(point1, point2), respectively.
Sim world extent, in the form of a vector of two GeoPoints, can be retrieved using simGetWorldExtents().</p>
<h3 id="weather-apis">Weather APIs<a class="headerlink" href="#weather-apis" title="Permanent link">#</a></h3>
<p>By default all weather effects are disabled. To enable weather effect, first call:</p>
<div class="highlight"><pre><span></span><code>simEnableWeather(True)
</code></pre></div>
<p>Various weather effects can be enabled by using <code>simSetWeatherParameter</code> method which takes <code>WeatherParameter</code>, for example,</p>
<p><div class="highlight"><pre><span></span><code>client.simSetWeatherParameter(airsim.WeatherParameter.Rain, 0.25);
</code></pre></div>
The second parameter value is from 0 to 1. The first parameter provides following options:</p>
<div class="highlight"><pre><span></span><code>class WeatherParameter:
    Rain = 0
    Roadwetness = 1
    Snow = 2
    RoadSnow = 3
    MapleLeaf = 4
    RoadLeaf = 5
    Dust = 6
    Fog = 7
</code></pre></div>
<p>Please note that <code>Roadwetness</code>, <code>RoadSnow</code> and <code>RoadLeaf</code> effects requires adding <a href="https://github.com/Microsoft/AirSim/tree/main/Unreal/Plugins/AirSim/Content/Weather/WeatherFX">materials</a> to your scene.</p>
<p>Please see <a href="https://github.com/Microsoft/AirSim/blob/main/PythonClient/environment/weather.py">example code</a> for more details.</p>
<h3 id="recording-apis">Recording APIs<a class="headerlink" href="#recording-apis" title="Permanent link">#</a></h3>
<p>Recording APIs can be used to start recording data through APIs. Data to be recorded can be specified using <a href="../settings/#recording">settings</a>. To start recording, use -</p>
<div class="highlight"><pre><span></span><code>client.startRecording()
</code></pre></div>
<p>Similarly, to stop recording, use <code>client.stopRecording()</code>. To check whether Recording is running, call <code>client.isRecording()</code>, returns a <code>bool</code>.</p>
<p>This API works alongwith toggling Recording using R button, therefore if it's enabled using R key, <code>isRecording()</code> will return <code>True</code>, and recording can be stopped via API using <code>stopRecording()</code>. Similarly, recording started using API will be stopped if R key is pressed in Viewport. LogMessage will also appear in the top-left of the viewport if recording is started or stopped using API.</p>
<p>Note that this will only save the data as specfied in the settings. For full freedom in storing data such as certain sensor information, or in a different format or layout, use the other APIs to fetch the data and save as desired. Check out <a href="../modify_recording_data/">Modifying Recording Data</a> for details on how to modify the kinematics data being recorded.</p>
<h3 id="wind-api">Wind API<a class="headerlink" href="#wind-api" title="Permanent link">#</a></h3>
<p>Wind can be changed during simulation using <code>simSetWind()</code>. Wind is specified in World frame, NED direction and m/s values</p>
<p>E.g. To set 20m/s wind in North (forward) direction -</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Set wind to (20,0,0) in NED (forward direction)</span>
<span class="n">wind</span> <span class="o">=</span> <span class="n">airsim</span><span class="o">.</span><span class="n">Vector3r</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">simSetWind</span><span class="p">(</span><span class="n">wind</span><span class="p">)</span>
</code></pre></div>
<p>Also see example script in <a href="https://github.com/Microsoft/AirSim/blob/main/PythonClient/multirotor/set_wind.py">set_wind.py</a></p>
<h3 id="lidar-apis">Lidar APIs<a class="headerlink" href="#lidar-apis" title="Permanent link">#</a></h3>
<p>AirSim offers API to retrieve point cloud data from Lidar sensors on vehicles. You can set the number of channels, points per second, horizontal and vertical FOV, etc parameters in <a href="../settings/">settings.json</a>.</p>
<p>More on <a href="../lidar/">lidar APIs and settings</a> and <a href="../sensors/">sensor settings</a></p>
<h3 id="light-control-apis">Light Control APIs<a class="headerlink" href="#light-control-apis" title="Permanent link">#</a></h3>
<p>Lights that can be manipulated inside AirSim can be created via the <code>simSpawnObject()</code> API by passing either <code>PointLightBP</code> or <code>SpotLightBP</code> as the <code>asset_name</code> parameter and <code>True</code> as the <code>is_blueprint</code> parameter. Once a light has been spawned, it can be manipulated using the following API:</p>
<ul>
<li><code>simSetLightIntensity</code>: This allows you to edit a light's intensity or brightness. It takes two parameters, <code>light_name</code>, the name of the light object returned by a previous call to <code>simSpawnObject()</code>, and <code>intensity</code>, a float value.</li>
</ul>
<h3 id="texture-apis">Texture APIs<a class="headerlink" href="#texture-apis" title="Permanent link">#</a></h3>
<p>Textures can be dynamically set on objects via these APIs:</p>
<ul>
<li><code>simSetObjectMaterial</code>: This sets an object's material using an existing Unreal material asset. It takes two string parameters, <code>object_name</code> and <code>material_name</code>.</li>
<li><code>simSetObjectMaterialFromTexture</code>: This sets an object's material using a path to a texture. It takes two string parameters, <code>object_name</code> and <code>texture_path</code>.</li>
</ul>
<h3 id="multiple-vehicles">Multiple Vehicles<a class="headerlink" href="#multiple-vehicles" title="Permanent link">#</a></h3>
<p>AirSim supports multiple vehicles and control them through APIs. Please <a href="../multi_vehicle/">Multiple Vehicles</a> doc.</p>
<h3 id="coordinate-system">Coordinate System<a class="headerlink" href="#coordinate-system" title="Permanent link">#</a></h3>
<p>All AirSim API uses NED coordinate system, i.e., +X is North, +Y is East and +Z is Down. All units are in SI system. Please note that this is different from coordinate system used internally by Unreal Engine. In Unreal Engine, +Z is up instead of down and length unit is in centimeters instead of meters. AirSim APIs takes care of the appropriate conversions. The starting point of the vehicle is always coordinates (0, 0, 0) in NED system. Thus when converting from Unreal coordinates to NED, we first subtract the starting offset and then scale by 100 for cm to m conversion. The vehicle is spawned in Unreal environment where the Player Start component is placed. There is a setting called <code>OriginGeopoint</code> in <a href="../settings/">settings.json</a> which assigns geographic longitude, longitude and altitude to the Player Start component.</p>
<h2 id="vehicle-specific-apis">Vehicle Specific APIs<a class="headerlink" href="#vehicle-specific-apis" title="Permanent link">#</a></h2>
<h3 id="apis-for-car">APIs for Car<a class="headerlink" href="#apis-for-car" title="Permanent link">#</a></h3>
<p>Car has followings APIs available:</p>
<ul>
<li><code>setCarControls</code>: This allows you to set throttle, steering, handbrake and auto or manual gear.</li>
<li><code>getCarState</code>: This retrieves the state information including speed, current gear and 6 kinematics quantities: position, orientation, linear and angular velocity, linear and angular acceleration. All quantities are in NED coordinate system, SI units in world frame except for angular velocity and accelerations which are in body frame.</li>
<li><a href="../image_apis/">Image APIs</a>.</li>
</ul>
<h3 id="apis-for-multirotor">APIs for Multirotor<a class="headerlink" href="#apis-for-multirotor" title="Permanent link">#</a></h3>
<p>Multirotor can be controlled by specifying angles, velocity vector, destination position or some combination of these. There are corresponding <code>move*</code> APIs for this purpose. When doing position control, we need to use some path following algorithm. By default AirSim uses carrot following algorithm. This is often referred to as "high level control" because you just need to specify high level goal and the firmware takes care of the rest. Currently lowest level control available in AirSim is <code>moveByAngleThrottleAsync</code> API.</p>
<h4 id="getmultirotorstate">getMultirotorState<a class="headerlink" href="#getmultirotorstate" title="Permanent link">#</a></h4>
<p>This API returns the state of the vehicle in one call. The state includes, collision, estimated kinematics (i.e. kinematics computed by fusing sensors), and timestamp (nano seconds since epoch). The kinematics here means 6 quantities: position, orientation, linear and angular velocity, linear and angular acceleration. Please note that simple_slight currently doesn't support state estimator which means estimated and ground truth kinematics values would be same for simple_flight. Estimated kinematics are however available for PX4 except for angular acceleration. All quantities are in NED coordinate system, SI units in world frame except for angular velocity and accelerations which are in body frame.</p>
<h4 id="async-methods-duration-and-max_wait_seconds">Async methods, duration and max_wait_seconds<a class="headerlink" href="#async-methods-duration-and-max_wait_seconds" title="Permanent link">#</a></h4>
<p>Many API methods has parameters named <code>duration</code> or <code>max_wait_seconds</code> and they have <em>Async</em> as suffix, for example, <code>takeoffAsync</code>. These methods will return immediately after starting the task in AirSim so that your client code can do something else while that task is being executed. If you want to wait for this task to complete then you can call <code>waitOnLastTask</code> like this:</p>
<div class="highlight"><pre><span></span><code><span class="c1">//C++</span>
<span class="n">client</span><span class="p">.</span><span class="n">takeoffAsync</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">waitOnLastTask</span><span class="p">();</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="cp"># Python</span>
<span class="n">client</span><span class="p">.</span><span class="n">takeoffAsync</span><span class="p">().</span><span class="n">join</span><span class="p">()</span>
</code></pre></div>
<p>If you start another command then it automatically cancels the previous task and starts new command. This allows to use pattern where your coded continuously does the sensing, computes a new trajectory to follow and issues that path to vehicle in AirSim. Each newly issued trajectory cancels the previous trajectory allowing your code to continuously do the update as new sensor data arrives.</p>
<p>All <em>Async</em> method returns <code>concurrent.futures.Future</code> in Python (<code>std::future</code> in C++). Please note that these future classes currently do not allow to check status or cancel the task; they only allow to wait for task to complete. AirSim does provide API <code>cancelLastTask</code>, however.</p>
<h4 id="drivetrain">drivetrain<a class="headerlink" href="#drivetrain" title="Permanent link">#</a></h4>
<p>There are two modes you can fly vehicle: <code>drivetrain</code> parameter is set to <code>airsim.DrivetrainType.ForwardOnly</code> or <code>airsim.DrivetrainType.MaxDegreeOfFreedom</code>. When you specify ForwardOnly, you are saying that vehicle's front should always point in the direction of travel. So if you want drone to take left turn then it would first rotate so front points to left. This mode is useful when you have only front camera and you are operating vehicle using FPV view. This is more or less like travelling in car where you always have front view. The MaxDegreeOfFreedom means you don't care where the front points to. So when you take left turn, you just start going left like crab. Quadrotors can go in any direction regardless of where front points to. The MaxDegreeOfFreedom enables this mode.</p>
<h4 id="yaw_mode">yaw_mode<a class="headerlink" href="#yaw_mode" title="Permanent link">#</a></h4>
<p><code>yaw_mode</code> is a struct <code>YawMode</code> with two fields, <code>yaw_or_rate</code> and <code>is_rate</code>. If <code>is_rate</code> field is True then <code>yaw_or_rate</code> field is interpreted as angular velocity in degrees/sec which means you want vehicle to rotate continuously around its axis at that angular velocity while moving. If <code>is_rate</code> is False then <code>yaw_or_rate</code> is interpreted as angle in degrees which means you want vehicle to rotate to specific angle (i.e. yaw) and keep that angle while moving.</p>
<p>You can probably see that when <code>yaw_mode.is_rate == true</code>, the <code>drivetrain</code> parameter shouldn't be set to <code>ForwardOnly</code> because you are contradicting by saying that keep front pointing ahead but also rotate continuously. However if you have <code>yaw_mode.is_rate = false</code> in <code>ForwardOnly</code> mode then you can do some funky stuff. For example, you can have drone do circles and have yaw_or_rate set to 90 so camera is always pointed to center ("super cool selfie mode"). In <code>MaxDegreeofFreedom</code> also you can get some funky stuff by setting <code>yaw_mode.is_rate = true</code> and say <code>yaw_mode.yaw_or_rate = 20</code>. This will cause drone to go in its path while rotating which may allow to do 360 scanning.</p>
<p>In most cases, you just don't want yaw to change which you can do by setting yaw rate of 0. The shorthand for this is <code>airsim.YawMode.Zero()</code> (or in C++: <code>YawMode::Zero()</code>).</p>
<h4 id="lookahead-and-adaptive_lookahead">lookahead and adaptive_lookahead<a class="headerlink" href="#lookahead-and-adaptive_lookahead" title="Permanent link">#</a></h4>
<p>When you ask vehicle to follow a path, AirSim uses "carrot following" algorithm. This algorithm operates by looking ahead on path and adjusting its velocity vector. The parameters for this algorithm is specified by <code>lookahead</code> and <code>adaptive_lookahead</code>. For most of the time you want algorithm to auto-decide the values by simply setting <code>lookahead = -1</code> and <code>adaptive_lookahead = 0</code>.</p>
<h2 id="using-apis-on-real-vehicles">Using APIs on Real Vehicles<a class="headerlink" href="#using-apis-on-real-vehicles" title="Permanent link">#</a></h2>
<p>We want to be able to run <em>same code</em> that runs in simulation as on real vehicle. This allows you to test your code in simulator and deploy to real vehicle.</p>
<p>Generally speaking, APIs therefore shouldn't allow you to do something that cannot be done on real vehicle (for example, getting the ground truth). But, of course, simulator has much more information and it would be useful in applications that may not care about running things on real vehicle. For this reason, we clearly delineate between sim-only APIs by attaching <code>sim</code> prefix, for example, <code>simGetGroundTruthKinematics</code>. This way you can avoid using these simulation-only APIs if you care about running your code on real vehicles.</p>
<p>The AirLib is self-contained library that you can put on an offboard computing module such as the Gigabyte barebone Mini PC. This module then can talk to the flight controllers such as PX4 using exact same code and flight controller protocol. The code you write for testing in the simulator remains unchanged. See <a href="../custom_drone/">AirLib on custom drones</a>.</p>
<h2 id="airsim-api">向 AirSim 添加新的 API<a class="headerlink" href="#airsim-api" title="Permanent link">#</a></h2>
<p>请参阅 <a href="../adding_new_apis/">添加新 API</a>  页面</p>
<h2 id="references-and-examples">References and Examples<a class="headerlink" href="#references-and-examples" title="Permanent link">#</a></h2>
<ul>
<li><a href="../apis_cpp/">C++ API Examples</a></li>
<li><a href="https://github.com/Microsoft/AirSim/tree/main/PythonClient//car">Car Examples</a></li>
<li><a href="https://github.com/Microsoft/AirSim/tree/main/PythonClient//multirotor">Multirotor Examples</a></li>
<li><a href="https://github.com/Microsoft/AirSim/tree/main/PythonClient//computer_vision">Computer Vision Examples</a></li>
<li><a href="https://github.com/Microsoft/AirSim/wiki/moveOnPath-demo">Move on Path</a> demo showing video of fast multirotor flight through Modular Neighborhood environment</li>
<li><a href="https://github.com/Microsoft/AirSim/wiki/hexacopter">Building a Hexacopter</a></li>
<li><a href="https://github.com/Microsoft/AirSim/wiki/Point-Clouds">Building Point Clouds</a></li>
</ul>
<h2 id="faq">FAQ<a class="headerlink" href="#faq" title="Permanent link">#</a></h2>
<h4 id="unreal-is-slowed-down-dramatically-when-i-run-api">Unreal is slowed down dramatically when I run API<a class="headerlink" href="#unreal-is-slowed-down-dramatically-when-i-run-api" title="Permanent link">#</a></h4>
<p>If you see Unreal getting slowed down dramatically when Unreal Engine window loses focus then go to 'Edit-&gt;Editor Preferences' in Unreal Editor, in the 'Search' box type 'CPU' and ensure that the 'Use Less CPU when in Background' is unchecked.</p>
<h4 id="do-i-need-anything-else-on-windows">Do I need anything else on Windows?<a class="headerlink" href="#do-i-need-anything-else-on-windows" title="Permanent link">#</a></h4>
<p>You should install VS2019 with VC++, Windows SDK 10.0 and Python. To use Python APIs you will need Python 3.5 or later (install it using Anaconda).</p>
<h4 id="which-version-of-python-should-i-use">Which version of Python should I use?<a class="headerlink" href="#which-version-of-python-should-i-use" title="Permanent link">#</a></h4>
<p>We recommend <a href="https://www.anaconda.com/download/">Anaconda</a> to get Python tools and libraries. Our code is tested with Python 3.5.3 :: Anaconda 4.4.0. This is important because older version have been known to have <a href="https://stackoverflow.com/a/45934992/207661">problems</a>.</p>
<h4 id="i-get-error-on-import-cv2">I get error on <code>import cv2</code><a class="headerlink" href="#i-get-error-on-import-cv2" title="Permanent link">#</a></h4>
<p>You can install OpenCV using:
<div class="highlight"><pre><span></span><code>conda install opencv
pip install opencv-python
</code></pre></div></p>
<h4 id="typeerror-unsupported-operand-types-for-asyncioloop-and-float">TypeError: unsupported operand type(s) for *: 'AsyncIOLoop' and 'float'<a class="headerlink" href="#typeerror-unsupported-operand-types-for-asyncioloop-and-float" title="Permanent link">#</a></h4>
<p>This error happens if you install Jupyter, which somehow breaks the msgpackrpc library.  Create a new python environment
which the minimal required packages.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../build_faq/" class="btn btn-neutral float-left" title="场景问题和回答"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../image_apis/" class="btn btn-neutral float-right" title="图像 APIs">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>OpenHUTB 版权所有 &copy; 2025</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../build_faq/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../image_apis/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
