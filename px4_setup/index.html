<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>AirSim 的 PX4 设置 - 低空模拟器</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "AirSim \u7684 PX4 \u8bbe\u7f6e";
        var mkdocs_page_input_path = "px4_setup.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> 低空模拟器
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">主页</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="..">主页</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">构建 AirSim</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../use_precompiled/">下载二进制文件</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_windows/">在 Windows 上构建</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_linux/">在 Linux 上构建</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_macos/">在 macOS 上构建</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../docker_ubuntu/">Linux 上的 Docker</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../azure/">Azure 上的 ArSim</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../unreal_custenv/">定制虚幻引擎环境</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_faq/">场景问题和回答</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">使用 AirSim</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../apis/">核心 APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../image_apis/">图像 APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../apis_cpp/">C++ APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../api_docs/html/index.html">API 参考文档</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../wiki/">Wiki 文档</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dev_workflow/">开发工作流</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../settings/">设置</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../map/">地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../camera_views/">相机视角</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../using_car/">汽车模式</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../remote_control/">远程控制</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../xbox_controller/">XBox 控制器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../steering_wheel_installation/">方向盘</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../multi_vehicle/">多车辆</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">传感器</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../sensors/">传感器</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../lidar/">激光雷达</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../distance_sensor/">距离传感器</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../InfraredCamera/">红外相机</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../airsim_ros_pkgs/">ROS: AirSim ROS 包装器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../airsim_tutorial_pkgs/">ROS: AirSim 教程包</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gazebo_drone/">导入 Gazebo 模型</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../retexturing/">域随机化</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../meshes/">网格顶点缓冲区</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../playback/">播放日志</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../voxel_grid/">体素网格生成器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../event_sim/">事件相机</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">设计</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../design/">架构</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../code_structure/">代码结构</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adding_new_apis/">添加新的 APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../modify_recording_data/">修改记录数据</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../coding_guidelines/">编码指南</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../flight_controller/">飞行控制器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../simple_flight/">简单飞行</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../hello_drone/">Hello Drone</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">外部飞行控制器</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">MavLink 和 PX4</a>
    <ul class="current">
                <li class="toctree-l2 current"><a class="reference internal current" href="./">AirSim 的 PX4 设置</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#supported-hardware">Supported Hardware</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#setting-up-px4-hardware-in-loop">Setting up PX4 Hardware-in-Loop</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#setting-up-px4-software-in-loop">Setting up PX4 Software-in-Loop</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#faq">FAQ</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#drone-doesnt-fly-properly-it-just-goes-crazy">Drone doesn't fly properly, it just goes "crazy".</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#can-i-use-arducopter-or-other-mavlink-implementations">Can I use Arducopter or other MavLink implementations?</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#it-is-not-finding-my-pixhawk-hardware">It is not finding my Pixhawk hardware</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#warn-commander-takeoff-denied-disarm-and-re-try">WARN  [commander] Takeoff denied, disarm and re-try</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#when-i-tell-the-drone-to-do-something-it-always-lands">When I tell the drone to do something it always lands</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#i-get-message-length-mismatches-errors">I get message length mismatches errors</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../px4_sitl/">软件在环中的 PX4</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../px4_sitl_wsl2/">带有 WSL 2 的 PX4 SITL</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../px4_lockstep/">PX4 Lockstep</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../px4_multi_vehicle/">软件在环中的 PX4 多车辆</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://youtu.be/1oY8Qu5maQQ">AirSim 与 Pixhawk</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://youtu.be/HNWdYrtw3f0">使用 AirSim 设置 PX4</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://www.youtube.com/watch?v=d_FyjKDWQfc&feature=youtu.be">调试姿态估计</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://github.com/Microsoft/AirSim/wiki/Intercepting-MavLink-messages">拦截 MavLink 消息</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://github.com/Microsoft/AirSim/wiki/Rapid-Descent-on-PX4-drones">PX4 无人机快速下降</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../px4_build/">构建 PX4</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../px4_logging/">PX4/MavLink 日志记录</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../log_viewer/">MavLink 日志查看器</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../mavlinkcom/">MavLinkCom</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../mavlinkcom_mocap/">MavLink MoCap</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">ArduPilot</a>
    <ul>
                <li class="toctree-l2"><a class="" href="https://ardupilot.org/dev/docs/building-the-code.html">ArduPilot 软件在环设置</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://ardupilot.org/dev/docs/sitl-with-airsim.html">AirSim & ArduPilot</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">升级</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../unreal_upgrade/">升级虚幻引擎</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../upgrade_apis/">升级 APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../upgrade_settings/">升级设置</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">贡献教程</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../reinforcement_learning/">强化学习</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://www.youtube.com/watch?v=y09VbdQWvQY">使用 Marketplace 中的环境</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/simondlevy/AirSimTensorFlow">简单的防撞</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://aka.ms/AutonomousDrivingCookbook">Azure 上的自动驾驶</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/Microsoft/AirSim/wiki/hexacopter">构造六旋翼飞行器</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/Microsoft/AirSim/wiki/moveOnPath-demo">移动路径演示</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../point_clouds/">构建点云</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../drone_survey/">使用无人机进行测量</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../orbit/">轨道轨迹</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://youtu.be/Bp86WiLUC80">导入自定义多旋翼网格</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../object_detection/">Object Detection</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://youtu.be/ZonkdMcwXH4">带有 MAVROS 和 PX4 的 AirSim</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">杂项</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../custom_drone/">真实无人机上的 AirSim</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cmake_linux/">在 Linux 上安装 cmake</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../hard_drive/">硬盘繁忙时的提示</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../pfm/">pfm 格式</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../unreal_proj/">设置虚幻引擎环境</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../unreal_blocks/">Blocks 环境</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../who_is_using/">谁在使用 AirSim</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../working_with_plugin_contents/">使用 UE 插件内容</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../wiki/technion/technion/">大学生方程式赛车以色列理工学院自驾赛</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">支持</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../faq/">FAQ</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../SUPPORT/">支持</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CHANGELOG/">修改记录</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../create_issue/">创建问题</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING/">贡献</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">低空模拟器</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">外部飞行控制器</li>
          <li class="breadcrumb-item">MavLink 和 PX4</li>
      <li class="breadcrumb-item active">AirSim 的 PX4 设置</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="px4-setup-for-airsim">PX4 Setup for AirSim<a class="headerlink" href="#px4-setup-for-airsim" title="Permanent link">#</a></h1>
<p>The <a href="http://github.com/px4/firmware">PX4 software stack</a> is an open source very popular flight controller with support for wide variety of boards and sensors as well as built-in capability for higher level tasks such as mission planning. Please visit <a href="http://px4.io">px4.io</a> for more information.</p>
<p><strong>Warning</strong>: While all releases of AirSim are always tested with PX4 to ensure the support, setting up PX4 is not a trivial task. Unless you have at least intermediate level of experience with PX4 stack, we recommend you use <a href="../simple_flight/">simple_flight</a>, which is now a default in AirSim.</p>
<h2 id="supported-hardware">Supported Hardware<a class="headerlink" href="#supported-hardware" title="Permanent link">#</a></h2>
<p>The following Pixhawk hardware has been tested with AirSim:</p>
<ol>
<li><a href="http://www.banggood.com/Pixhawk-PX4-2_4_8-Flight-Controller-32-Bit-ARM-PX4FMU-PX4IO-Combo-for-Multicopters-p-1040416.html">Pixhawk PX4 2.4.8</a></li>
<li><a href="https://hobbyking.com/en_us/pixfalcon-micro-px4-autopilot.html?___store=en_us">PixFalcon</a></li>
<li><a href="https://www.banggood.com/Pixracer-Autopilot-Xracer-V1_0-Flight-Controller-Mini-PX4-Built-in-Wifi-For-FPV-Racing-RC-Multirotor-p-1056428.html?utm_source=google&amp;utm_medium=cpc_ods&amp;utm_content=starr&amp;utm_campaign=Smlrfpv-ds-FPVracer&amp;gclid=CjwKEAjw9MrIBRCr2LPek5-h8U0SJAD3jfhtbEfqhX4Lu94kPe88Zrr62A5qVgx-wRDBuUulGzHELRoCRVTw_wcB">PixRacer</a></li>
<li><a href="http://www.proficnc.com/">Pixhawk 2.1</a></li>
<li><a href="https://shop.holybro.com/pixhawk4-mini_p1120.html">Pixhawk 4 mini from Holybro</a></li>
<li><a href="https://shop.holybro.com/pixhawk-4beta-launch_p1089.html">Pixhawk 4 from Holybro</a></li>
</ol>
<p>Version 1.11.2 of the PX4 firmware also works on the Pixhawk 4 devices.</p>
<h2 id="setting-up-px4-hardware-in-loop">Setting up PX4 Hardware-in-Loop<a class="headerlink" href="#setting-up-px4-hardware-in-loop" title="Permanent link">#</a></h2>
<p>For this you will need one of the supported device listed above. For manual flight you will also need RC + transmitter.</p>
<ol>
<li>Make sure your RC receiver is bound with its RC transmitter. Connect the RC transmitter to the flight controller's RC port. Refer to your RC manual and <a href="https://docs.px4.io/en/getting_started/rc_transmitter_receiver.html">PX4 docs</a> for more information.</li>
<li>Download <a href="http://qgroundcontrol.com/">QGroundControl</a>, launch it and connect your flight controller to the USB port.</li>
<li>Use QGroundControl to flash the latest PX4 Flight Stack.
See also <a href="https://docs.px4.io/master/en/config/">initial firmware setup video</a>.</li>
<li>In QGroundControl, configure your Pixhawk for HIL simulation by selecting the HIL Quadrocopter X airframe.  After PX4 reboots, check that "HIL Quadrocopter X" is indeed selected.</li>
<li>In QGroundControl, go to Radio tab and calibrate (make sure the remote control is on and the receiver is showing the indicator for the binding).</li>
<li>Go to the Flight Mode tab and chose one of the remote control switches as "Mode Channel". Then set (for example) Stabilized and Attitude flight modes for two positions of the switch.</li>
<li>Go to the Tuning section of QGroundControl and set appropriate values. For example, for Fly Sky's FS-TH9X remote control, the following settings give a more realistic feel: Hover Throttle = mid+1 mark, Roll and pitch sensitivity = mid-3 mark, Altitude and position control sensitivity = mid-2 mark.</li>
<li>In <a href="../settings/">AirSim settings</a> file, specify PX4 for your vehicle config like this:
<div class="highlight"><pre><span></span><code>    {
        &quot;SettingsVersion&quot;: 1.2,
        &quot;SimMode&quot;: &quot;Multirotor&quot;,
        &quot;ClockType&quot;: &quot;SteppableClock&quot;,
        &quot;Vehicles&quot;: {
            &quot;PX4&quot;: {
                &quot;VehicleType&quot;: &quot;PX4Multirotor&quot;,
                &quot;UseSerial&quot;: true,
                &quot;LockStep&quot;: true,
                &quot;Sensors&quot;:{
                    &quot;Barometer&quot;:{
                        &quot;SensorType&quot;: 1,
                        &quot;Enabled&quot;: true,
                        &quot;PressureFactorSigma&quot;: 0.0001825
                    }
                },
                &quot;Parameters&quot;: {
                    &quot;NAV_RCL_ACT&quot;: 0,
                    &quot;NAV_DLL_ACT&quot;: 0,
                    &quot;COM_OBL_ACT&quot;: 1,
                    &quot;LPE_LAT&quot;: 47.641468,
                    &quot;LPE_LON&quot;: -122.140165
                }
            }
        }
    }
</code></pre></div></li>
</ol>
<p>Notice the PX4 <code>[simulator]</code> is using TCP, which is why we need to add: <code>"UseTcp": true,</code>. Notice we
are also enabling <code>LockStep</code>, see <a href="../px4_lockstep/">PX4 LockStep</a> for more information. The
<code>Barometer</code> setting keeps PX4 happy because the default AirSim barometer has a bit too much noise
generation.  This setting clamps that down a bit which allows PX4 to achieve GPS lock more quickly.</p>
<p>After above setup you should be able to use a remote control (RC) to fly with AirSim. You can usually arm the vehicle by lowering and bringing two sticks of RC together down and in-wards. You don't need QGroundControl after the initial setup. Typically the Stabilized (instead of Manual) mode gives better experience for beginners.  See <a href="https://docs.px4.io/master/en/flying/basic_flying.html">PX4 Basic Flying Guide</a>.</p>
<p>You can also control the drone from <a href="../apis/">Python APIs</a>.</p>
<p>See <a href="https://youtu.be/HNWdYrtw3f0">Walkthrough Demo Video</a> and  <a href="https://youtu.be/1oY8Qu5maQQ">Unreal AirSim Setup  Video</a> that shows you all the setup steps in this document.</p>
<h2 id="setting-up-px4-software-in-loop">Setting up PX4 Software-in-Loop<a class="headerlink" href="#setting-up-px4-software-in-loop" title="Permanent link">#</a></h2>
<p>The PX4 SITL mode doesn't require you to have separate device such as a Pixhawk or Pixracer. This is in fact the recommended way to use PX4 with simulators by PX4 team. However, this is indeed harder to set up. Please see <a href="../px4_sitl/">this dedicated page</a> for setting up PX4 in SITL mode.</p>
<h2 id="faq">FAQ<a class="headerlink" href="#faq" title="Permanent link">#</a></h2>
<h4 id="drone-doesnt-fly-properly-it-just-goes-crazy">Drone doesn't fly properly, it just goes "crazy".<a class="headerlink" href="#drone-doesnt-fly-properly-it-just-goes-crazy" title="Permanent link">#</a></h4>
<p>There are a few reasons that can cause this. First, make sure your drone doesn't fall down large distance when starting the simulator. This might happen if you have created a custom Unreal environment and Player Start is placed too high above the ground. It seems that when this happens internal calibration in PX4 gets confused.</p>
<p>You should <a href="#setting-up-px4-hardware-in-loop">also use QGroundControl</a> and make sure you can arm and takeoff in QGroundControl properly.</p>
<p>Finally, this also can be a machine performance issue in some rare cases, check your <a href="../hard_drive/">hard drive performance</a>.</p>
<h4 id="can-i-use-arducopter-or-other-mavlink-implementations">Can I use Arducopter or other MavLink implementations?<a class="headerlink" href="#can-i-use-arducopter-or-other-mavlink-implementations" title="Permanent link">#</a></h4>
<p>Our code is tested with the <a href="https://dev.px4.io/">PX4 firmware</a>. We have not tested Arducopter or other mavlink implementations. Some of the flight API's do use the
PX4 custom modes in the MAV_CMD_DO_SET_MODE messages (like PX4_CUSTOM_MAIN_MODE_AUTO)</p>
<h4 id="it-is-not-finding-my-pixhawk-hardware">It is not finding my Pixhawk hardware<a class="headerlink" href="#it-is-not-finding-my-pixhawk-hardware" title="Permanent link">#</a></h4>
<p>Check your settings.json file for this line "SerialPort":"*,115200".  The asterisk here means "find any
serial port that looks like a Pixhawk device, but this doesn't always work for all types of Pixhawk hardware.
So on Windows you can find the actual COM port using Device Manager, look under "Ports (COM &amp; LPT), plug the
device in and see what new COM port shows up.  Let's say you see a new port named "USB Serial Port (COM5)".
Well, then change the SerialPort setting to this: "SerialPort":"COM5,115200".</p>
<p>On Linux, the device can be found by running "ls /dev/serial/by-id" if you see a device name listed that looks
like this <code>usb-3D_Robotics_PX4_FMU_v2.x_0-if00</code> then you can use that name to connect, like this:
"SerialPort":"/dev/serial/by-id/usb-3D_Robotics_PX4_FMU_v2.x_0-if00".  Note this long name is actually a symbolic link to the real
name, if you use "ls -l ..." you can find that symbolic link, it is usually something like "/dev/ttyACM0",
so this will also work "SerialPort":"/dev/ttyACM0,115200".  But that mapping is similar to windows, it is
automatically assigned and can change, whereas the long name will work even if the actual TTY serial device
mapping changes.</p>
<h4 id="warn-commander-takeoff-denied-disarm-and-re-try">WARN  [commander] Takeoff denied, disarm and re-try<a class="headerlink" href="#warn-commander-takeoff-denied-disarm-and-re-try" title="Permanent link">#</a></h4>
<p>This happens if you try and take off when  PX4 still has not computed the home position.  PX4 will report the home
position once it is happy with the GPS signal, and you will see these messages:</p>
<div class="highlight"><pre><span></span><code>INFO  [commander] home: 47.6414680, -122.1401672, 119.99
INFO  [tone_alarm] home_set
</code></pre></div>
<p>Up until this point in time, however, the PX4 will reject takeoff commands.</p>
<h4 id="when-i-tell-the-drone-to-do-something-it-always-lands">When I tell the drone to do something it always lands<a class="headerlink" href="#when-i-tell-the-drone-to-do-something-it-always-lands" title="Permanent link">#</a></h4>
<p>For example, you use DroneShell <code>moveToPosition -z -20 -x 50 -y 0</code> which it does, but when it gets to the target location the
drone starts to land.  This is the default behavior of PX4 when offboard mode completes.  To set the drone to hover instead
set this PX4 parameter:
<div class="highlight"><pre><span></span><code>param set COM_OBL_ACT 1
</code></pre></div></p>
<h4 id="i-get-message-length-mismatches-errors">I get message length mismatches errors<a class="headerlink" href="#i-get-message-length-mismatches-errors" title="Permanent link">#</a></h4>
<p>You might need to set MAV_PROTO_VER parameter in QGC to "Always use version 1". Please see <a href="https://github.com/Microsoft/AirSim/issues/546">this issue</a> more details.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../hello_drone/" class="btn btn-neutral float-left" title="Hello Drone"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../px4_sitl/" class="btn btn-neutral float-right" title="软件在环中的 PX4">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>OpenHUTB 版权所有 &copy; 2025</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../hello_drone/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../px4_sitl/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
