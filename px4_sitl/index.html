<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>软件在环中的 PX4 - 低空模拟器</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "\u8f6f\u4ef6\u5728\u73af\u4e2d\u7684 PX4";
        var mkdocs_page_input_path = "px4_sitl.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> 低空模拟器
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">主页</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="..">主页</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">构建 AirSim</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../use_precompiled/">下载二进制文件</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_windows/">在 Windows 上构建</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_linux/">在 Linux 上构建</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_macos/">在 macOS 上构建</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../docker_ubuntu/">Linux 上的 Docker</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../azure/">Azure 上的 ArSim</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../unreal_custenv/">定制虚幻引擎环境</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_faq/">场景问题和回答</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">使用 AirSim</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../apis/">核心 APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../image_apis/">图像 APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../apis_cpp/">C++ APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../api_docs/html/index.html">API 参考文档</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../wiki/">Wiki 文档</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dev_workflow/">开发工作流</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../settings/">设置</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../map/">地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../camera_views/">相机视角</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../using_car/">汽车模式</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../remote_control/">远程控制</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../xbox_controller/">XBox 控制器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../steering_wheel_installation/">方向盘</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../multi_vehicle/">多车辆</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">传感器</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../sensors/">传感器</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../lidar/">激光雷达</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../distance_sensor/">距离传感器</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../InfraredCamera/">红外相机</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../airsim_ros_pkgs/">ROS: AirSim ROS 包装器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../airsim_tutorial_pkgs/">ROS: AirSim 教程包</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gazebo_drone/">导入 Gazebo 模型</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../retexturing/">域随机化</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../meshes/">网格顶点缓冲区</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../playback/">播放日志</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../voxel_grid/">体素网格生成器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../event_sim/">事件相机</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">设计</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../design/">架构</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../code_structure/">代码结构</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adding_new_apis/">添加新的 APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../modify_recording_data/">修改记录数据</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../coding_guidelines/">编码指南</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../flight_controller/">飞行控制器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../simple_flight/">简单飞行</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../hello_drone/">Hello Drone</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">外部飞行控制器</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">MavLink 和 PX4</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../px4_setup/">AirSim 的 PX4 设置</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="./">软件在环中的 PX4</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#setting-gps-origin">Setting GPS origin</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#smooth-offboard-transitions">Smooth Offboard Transitions</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#check-the-home-position">Check the Home Position</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#wsl-2">WSL 2</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#no-remote-control">No Remote Control</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#manually-set-parameters">Manually set parameters</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#setting-up-multi-vehicle-simulation">Setting up multi-vehicle simulation</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#using-virtualbox-ubuntu">Using VirtualBox Ubuntu</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#remote-controller">Remote Controller</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../px4_sitl_wsl2/">带有 WSL 2 的 PX4 SITL</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../px4_lockstep/">PX4 Lockstep</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../px4_multi_vehicle/">软件在环中的 PX4 多车辆</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://youtu.be/1oY8Qu5maQQ">AirSim 与 Pixhawk</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://youtu.be/HNWdYrtw3f0">使用 AirSim 设置 PX4</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://www.youtube.com/watch?v=d_FyjKDWQfc&feature=youtu.be">调试姿态估计</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://github.com/Microsoft/AirSim/wiki/Intercepting-MavLink-messages">拦截 MavLink 消息</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://github.com/Microsoft/AirSim/wiki/Rapid-Descent-on-PX4-drones">PX4 无人机快速下降</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../px4_build/">构建 PX4</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../px4_logging/">PX4/MavLink 日志记录</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../log_viewer/">MavLink 日志查看器</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../mavlinkcom/">MavLinkCom</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../mavlinkcom_mocap/">MavLink MoCap</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">ArduPilot</a>
    <ul>
                <li class="toctree-l2"><a class="" href="https://ardupilot.org/dev/docs/building-the-code.html">ArduPilot 软件在环设置</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://ardupilot.org/dev/docs/sitl-with-airsim.html">AirSim & ArduPilot</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">升级</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../unreal_upgrade/">升级虚幻引擎</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../upgrade_apis/">升级 APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../upgrade_settings/">升级设置</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">贡献教程</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../reinforcement_learning/">强化学习</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://www.youtube.com/watch?v=y09VbdQWvQY">使用 Marketplace 中的环境</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/simondlevy/AirSimTensorFlow">简单的防撞</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://aka.ms/AutonomousDrivingCookbook">Azure 上的自动驾驶</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/Microsoft/AirSim/wiki/hexacopter">构造六旋翼飞行器</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/Microsoft/AirSim/wiki/moveOnPath-demo">移动路径演示</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../point_clouds/">构建点云</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../drone_survey/">使用无人机进行测量</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../orbit/">轨道轨迹</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://youtu.be/Bp86WiLUC80">导入自定义多旋翼网格</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../object_detection/">Object Detection</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://youtu.be/ZonkdMcwXH4">带有 MAVROS 和 PX4 的 AirSim</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">杂项</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../custom_drone/">真实无人机上的 AirSim</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cmake_linux/">在 Linux 上安装 cmake</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../hard_drive/">硬盘繁忙时的提示</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../pfm/">pfm 格式</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../unreal_proj/">设置虚幻引擎环境</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../unreal_blocks/">Blocks 环境</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../who_is_using/">谁在使用 AirSim</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../working_with_plugin_contents/">使用 UE 插件内容</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../wiki/technion/technion/">大学生方程式赛车以色列理工学院自驾赛</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">支持</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../faq/">FAQ</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../SUPPORT/">支持</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CHANGELOG/">修改记录</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../create_issue/">创建问题</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING/">贡献</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">低空模拟器</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">外部飞行控制器</li>
          <li class="breadcrumb-item">MavLink 和 PX4</li>
      <li class="breadcrumb-item active">软件在环中的 PX4</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="setting-up-px4-software-in-loop">Setting up PX4 Software-in-Loop<a class="headerlink" href="#setting-up-px4-software-in-loop" title="Permanent link">#</a></h1>
<p>The <a href="http://dev.px4.io">PX4</a> software provides a "software-in-loop" simulation (SITL) version of
their stack that runs in Linux. If you are on Windows then you can use the <a href="https://dev.px4.io/master/en/setup/dev_env_windows_cygwin.html">Cygwin
Toolchain</a> or you can use the
<a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">Windows subsystem for Linux</a> and follow
the PX4 Linux toolchain setup.</p>
<p>If you are using WSL2 please read these <a href="../px4_sitl_wsl2/">additional
instructions</a>.</p>
<p><strong>Note</strong> that every time you stop the unreal app you have to restart the <code>px4</code> app.</p>
<ol>
<li>
<p>From your bash terminal follow <a href="https://docs.px4.io/master/en/dev_setup/dev_env_linux.html">these steps for
   Linux</a> and follow <strong>all</strong> the
   instructions under <code>NuttX based hardware</code> to install prerequisites. We've also included our own
   copy of the <a href="../px4_build/">PX4 build instructions</a> which is a bit more concise about what we need
   exactly.</p>
</li>
<li>
<p>Get the PX4 source code and build the posix SITL version of PX4:
    <div class="highlight"><pre><span></span><code>mkdir -p PX4
cd PX4
git clone https://github.com/PX4/PX4-Autopilot.git --recursive
bash ./PX4-Autopilot/Tools/setup/ubuntu.sh --no-nuttx --no-sim-tools
cd PX4-Autopilot
</code></pre></div>
    And find the latest stable release from <a href="https://github.com/PX4/PX4-Autopilot/releases">https://github.com/PX4/PX4-Autopilot/releases</a>
    and checkout the source code matching that release, for example:
    <div class="highlight"><pre><span></span><code>git checkout v1.11.3
</code></pre></div></p>
</li>
<li>
<p>Use following command to build and start PX4 firmware in SITL mode:
    <div class="highlight"><pre><span></span><code>make px4_sitl_default none_iris
</code></pre></div>
   If you are using older version v1.8.* use this command instead: <code>make posix_sitl_ekf2 none_iris</code>.</p>
</li>
<li>
<p>You should see a message saying the SITL PX4 app is waiting for the simulator (AirSim) to connect.
You will also see information about which ports are configured for mavlink connection to the PX4 app.
The default ports have changed recently, so check them closely to make sure AirSim settings are correct.
    <div class="highlight"><pre><span></span><code>INFO  [simulator] Waiting for simulator to connect on TCP port 4560
INFO  [init] Mixer: etc/mixers/quad_w.main.mix on /dev/pwm_output0
INFO  [mavlink] mode: Normal, data rate: 4000000 B/s on udp port 14570 remote port 14550
INFO  [mavlink] mode: Onboard, data rate: 4000000 B/s on udp port 14580 remote port 14540
</code></pre></div></p>
<p>Note: this is also an interactive PX4 console, type <code>help</code> to see the
list of commands you can enter here.  They are mostly low level PX4
commands, but some of them can be useful for debugging.</p>
</li>
<li>
<p>Now edit <a href="../settings/">AirSim settings</a> file to make sure you have matching UDP and TCP port settings:
    <div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;SettingsVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.2</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;SimMode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Multirotor&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ClockType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SteppableClock&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Vehicles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;PX4&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;VehicleType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PX4Multirotor&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;UseSerial&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;LockStep&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;UseTcp&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;TcpPort&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4560</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;ControlPortLocal&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">14540</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;ControlPortRemote&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">14580</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;Sensors&quot;</span><span class="p">:{</span>
<span class="w">                </span><span class="nt">&quot;Barometer&quot;</span><span class="p">:{</span>
<span class="w">                    </span><span class="nt">&quot;SensorType&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;Enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;PressureFactorSigma&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0001825</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nt">&quot;Parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;NAV_RCL_ACT&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;NAV_DLL_ACT&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;COM_OBL_ACT&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;LPE_LAT&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">47.641468</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;LPE_LON&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">-122.140165</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
    Notice the PX4 <code>[simulator]</code> is using TCP, which is why we need to add: <code>"UseTcp": true,</code>.
    Notice we are also enabling <code>LockStep</code>, see <a href="../px4_lockstep/">PX4 LockStep</a> for more
    information. The <code>Barometer</code> setting keeps PX4 happy because the default AirSim barometer has a
    bit too much noise generation.  This setting clamps that down a bit which allows PX4 to achieve
    GPS lock more quickly.</p>
</li>
<li>
<p>Open incoming TCP port 4560 and incoming UDP port 14540 using your firewall configuration.</p>
</li>
<li>
<p>Now run your Unreal AirSim environment and it should connect to SITL PX4 via TCP. You should see
   a bunch of messages from the SITL PX4 window. Specifically, the following messages tell you that
   AirSim is connected properly and GPS fusion is stable:
    <div class="highlight"><pre><span></span><code>INFO  [simulator] Simulator connected on UDP port 14560
INFO  [mavlink] partner IP: 127.0.0.1
INFO  [ecl/EKF] EKF GPS checks passed (WGS-84 origin set)
INFO  [ecl/EKF] EKF commencing GPS fusion
</code></pre></div></p>
<p>If you do not see these messages then check your port settings.</p>
</li>
<li>
<p>You should also be able to use QGroundControl with SITL mode.  Make sure there is no Pixhawk
   hardware plugged in, otherwise QGroundControl will choose to use that instead.  Note that as we
   don't have a physical board, an RC cannot be connected directly to it. So the alternatives are
   either use XBox 360 Controller or connect your RC using USB (for example, in case of FrSky
   Taranis X9D Plus) or using trainer USB cable to your PC. This makes your RC look like a joystick.
   You will need to do extra set up in QGroundControl to use virtual joystick for RC control.  You
   do not need to do this unless you plan to fly a drone manually in AirSim.  Autonomous flight
   using the Python API does not require RC, see <code>No Remote Control</code> below.</p>
</li>
</ol>
<h2 id="setting-gps-origin">Setting GPS origin<a class="headerlink" href="#setting-gps-origin" title="Permanent link">#</a></h2>
<p>Notice the above settings are provided in the <code>params</code> section of the <code>settings.json</code> file:
<div class="highlight"><pre><span></span><code>    &quot;LPE_LAT&quot;: 47.641468,
    &quot;LPE_LON&quot;: -122.140165,
</code></pre></div></p>
<p>PX4 SITL mode needs to be configured to get the home location correct.
The home location needs to be set to the same coordinates defined in  <a href="../settings/#origingeopoint">OriginGeopoint</a>.</p>
<p>You can also run the following in the SITL PX4 console window to check
that these values are set correctly.</p>
<div class="highlight"><pre><span></span><code>param show LPE_LAT
param show LPE_LON
</code></pre></div>
<h2 id="smooth-offboard-transitions">Smooth Offboard Transitions<a class="headerlink" href="#smooth-offboard-transitions" title="Permanent link">#</a></h2>
<p>Notice the above setting is provided in the <code>params</code> section of the <code>settings.json</code> file:
<div class="highlight"><pre><span></span><code>    &quot;COM_OBL_ACT&quot;: 1
</code></pre></div></p>
<p>This tells the drone automatically hover after each offboard control command finishes (the default
setting is to land).  Hovering is a smoother transition between multiple offboard commands.  You can
check this setting by running the following PX4 console command:</p>
<div class="highlight"><pre><span></span><code>param show COM_OBL_ACT
</code></pre></div>
<h2 id="check-the-home-position">Check the Home Position<a class="headerlink" href="#check-the-home-position" title="Permanent link">#</a></h2>
<p>If you are using DroneShell to execute commands (arm, takeoff, etc) then you should wait until the
Home position is set. You will see the PX4 SITL console output this message:</p>
<div class="highlight"><pre><span></span><code>INFO  [commander] home: 47.6414680, -122.1401672, 119.99
INFO  [tone_alarm] home_set
</code></pre></div>
<p>Now DroneShell 'pos' command should report this position and the commands should be accepted by PX4.
If you attempt to takeoff without a home position you will see the message:</p>
<div class="highlight"><pre><span></span><code>WARN  [commander] Takeoff denied, disarm and re-try
</code></pre></div>
<p>After home position is set check the local position reported by 'pos' command :</p>
<div class="highlight"><pre><span></span><code>Local position: x=-0.0326988, y=0.00656854, z=5.48506
</code></pre></div>
<p>If the z coordinate is large like this then takeoff might not work as expected.  Resetting the SITL
and simulation should fix that problem.</p>
<h2 id="wsl-2">WSL 2<a class="headerlink" href="#wsl-2" title="Permanent link">#</a></h2>
<p>Windows Subsystem for Linux version 2 operates in a Virtual Machine.  This requires
additional setup - see <a href="../px4_sitl_wsl2/">additional instructions</a>.</p>
<h2 id="no-remote-control">No Remote Control<a class="headerlink" href="#no-remote-control" title="Permanent link">#</a></h2>
<p>Notice the above setting is provided in the <code>params</code> section of the <code>settings.json</code> file:
<div class="highlight"><pre><span></span><code>    &quot;NAV_RCL_ACT&quot;: 0,
    &quot;NAV_DLL_ACT&quot;: 0,
</code></pre></div></p>
<p>This is required if you plan to fly the SITL mode PX4 with no remote control, just using python
scripts, for example.  These parameters stop the PX4 from triggering "failsafe mode on" every time a
move command is finished.  You can use the following PX4 command to check these values are set
correctly:</p>
<div class="highlight"><pre><span></span><code>param show NAV_RCL_ACT
param show NAV_DLL_ACT
</code></pre></div>
<p>NOTE: Do <code>NOT</code> do this on a real drone as it is too dangerous to fly without these failsafe measures.</p>
<h2 id="manually-set-parameters">Manually set parameters<a class="headerlink" href="#manually-set-parameters" title="Permanent link">#</a></h2>
<p>You can also run the following in the PX4 console to set all these parameters manually:</p>
<div class="highlight"><pre><span></span><code>param set NAV_RCL_ACT 0
param set NAV_DLL_ACT 0
</code></pre></div>
<h2 id="setting-up-multi-vehicle-simulation">Setting up multi-vehicle simulation<a class="headerlink" href="#setting-up-multi-vehicle-simulation" title="Permanent link">#</a></h2>
<p>You can simulate multiple drones in SITL mode using AirSim. However, this requires setting up
multiple instances of the PX4 firmware simulator to be able to listen for each vehicle's connection
on a separate TCP port (4560, 4561, etc). Please see <a href="../px4_multi_vehicle/">this dedicated page</a> for
instructions on setting up multiple instances of PX4 in SITL mode.</p>
<h2 id="using-virtualbox-ubuntu">Using VirtualBox Ubuntu<a class="headerlink" href="#using-virtualbox-ubuntu" title="Permanent link">#</a></h2>
<p>If you want to run the above posix_sitl in a <code>VirtualBox Ubuntu</code> machine then it will have a
different ip address from localhost. So in this case you need to edit the <a href="../settings/">settings
file</a> and change the UdpIp and SitlIp to the ip address of your virtual machine set the
LocalIpAddress to the address of your host machine running the Unreal engine.</p>
<h2 id="remote-controller">Remote Controller<a class="headerlink" href="#remote-controller" title="Permanent link">#</a></h2>
<p>There are several options for flying the simulated drone using a remote control or joystick like
xbox gamepad. See <a href="../remote_control/#rc-setup-for-px4">remote controllers</a></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../px4_setup/" class="btn btn-neutral float-left" title="AirSim 的 PX4 设置"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../px4_sitl_wsl2/" class="btn btn-neutral float-right" title="带有 WSL 2 的 PX4 SITL">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>OpenHUTB 版权所有 &copy; 2025</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../px4_setup/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../px4_sitl_wsl2/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
